/**
 * almond 0.2.4 Copyright (c) 2011-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/*
 RequireJS text 1.0.2 Copyright (c) 2010-2011, The Dojo Foundation All Rights Reserved.
 Available via the MIT or new BSD license.
 see: http://github.com/jrburke/requirejs for details
*/

/*! jQuery UI - v1.10.1 - 2013-02-20
* http://jqueryui.com
* Includes: jquery.ui.core.js, jquery.ui.widget.js, jquery.ui.mouse.js, jquery.ui.slider.js
* Copyright (c) 2013 jQuery Foundation and other contributors Licensed MIT */

/*
 * jQuery UI Touch Punch 0.2.2
 *
 * Copyright 2011, Dave Furfero
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * Depends:
 *  jquery.ui.widget.js
 *  jquery.ui.mouse.js
 */

//     (c) 2010-2012 Jeremy Ashkenas, DocumentCloud Inc.
//     Backbone may be freely distributed under the MIT license.
//     For all details and documentation:
//     http://backbonejs.org

function printStackTrace(e){e=e||{guess:!0};var t=e.e||null,n=!!e.guess,r=new printStackTrace.implementation,i=r.run(t);return n?r.guessAnonymousFunctions(i):i}$.holdReady(!0);var requirejs,require,define;(function(e){function c(e,t){return f.call(e,t)}function h(e,t){var n,r,i,s,o,a,f,l,c,h,p=t&&t.split("/"),d=u.map,v=d&&d["*"]||{};if(e&&e.charAt(0)===".")if(t){p=p.slice(0,p.length-1),e=p.concat(e.split("/"));for(l=0;l<e.length;l+=1){h=e[l];if(h===".")e.splice(l,1),l-=1;else if(h===".."){if(l===1&&(e[2]===".."||e[0]===".."))break;l>0&&(e.splice(l-1,2),l-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((p||v)&&d){n=e.split("/");for(l=n.length;l>0;l-=1){r=n.slice(0,l).join("/");if(p)for(c=p.length;c>0;c-=1){i=d[p.slice(0,c).join("/")];if(i){i=i[r];if(i){s=i,o=l;break}}}if(s)break;!a&&v&&v[r]&&(a=v[r],f=l)}!s&&a&&(s=a,o=f),s&&(n.splice(0,o,s),e=n.join("/"))}return e}function p(t,r){return function(){return n.apply(e,l.call(arguments,0).concat([t,r]))}}function d(e){return function(t){return h(t,e)}}function v(e){return function(t){s[e]=t}}function m(n){if(c(o,n)){var r=o[n];delete o[n],a[n]=!0,t.apply(e,r)}if(!c(s,n)&&!c(a,n))throw new Error("No "+n);return s[n]}function g(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function y(e){return function(){return u&&u.config&&u.config[e]||{}}}var t,n,r,i,s={},o={},u={},a={},f=Object.prototype.hasOwnProperty,l=[].slice;r=function(e,t){var n,r=g(e),i=r[0];return e=r[1],i&&(i=h(i,t),n=m(i)),i?n&&n.normalize?e=n.normalize(e,d(t)):e=h(e,t):(e=h(e,t),r=g(e),i=r[0],e=r[1],i&&(n=m(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},i={require:function(e){return p(e)},exports:function(e){var t=s[e];return typeof t!="undefined"?t:s[e]={}},module:function(e){return{id:e,uri:"",exports:s[e],config:y(e)}}},t=function(t,n,u,f){var l,h,d,g,y,b=[],w;f=f||t;if(typeof u=="function"){n=!n.length&&u.length?["require","exports","module"]:n;for(y=0;y<n.length;y+=1){g=r(n[y],f),h=g.f;if(h==="require")b[y]=i.require(t);else if(h==="exports")b[y]=i.exports(t),w=!0;else if(h==="module")l=b[y]=i.module(t);else if(c(s,h)||c(o,h)||c(a,h))b[y]=m(h);else{if(!g.p)throw new Error(t+" missing "+h);g.p.load(g.n,p(f,!0),v(h),{}),b[y]=s[h]}}d=u.apply(s[t],b);if(t)if(l&&l.exports!==e&&l.exports!==s[t])s[t]=l.exports;else if(d!==e||!w)s[t]=d}else t&&(s[t]=u)},requirejs=require=n=function(s,o,a,f,l){return typeof s=="string"?i[s]?i[s](o):m(r(s,o).f):(s.splice||(u=s,o.splice?(s=o,o=a,a=null):s=e),o=o||function(){},typeof a=="function"&&(a=f,f=l),f?t(e,s,o,a):setTimeout(function(){t(e,s,o,a)},4),n)},n.config=function(e){return u=e,n},define=function(e,t,n){t.splice||(n=t,t=[]),!c(s,e)&&!c(o,e)&&(o[e]=[e,t,n])},define.amd={jQuery:!0}})(),define("almond",function(){}),function(){var e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,s=Function.prototype,o=r.push,u=r.slice,a=r.concat,f=i.toString,l=i.hasOwnProperty,c=r.forEach,h=r.map,p=r.reduce,d=r.reduceRight,v=r.filter,m=r.every,g=r.some,y=r.indexOf,b=r.lastIndexOf,w=Array.isArray,E=Object.keys,S=s.bind,x=function(e){return e instanceof x?e:this instanceof x?(this._wrapped=e,void 0):new x(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=x),exports._=x):e._=x,x.VERSION="1.4.4";var T=x.each=x.forEach=function(e,t,r){if(null!=e)if(c&&e.forEach===c)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,s=e.length;s>i;i++)if(t.call(r,e[i],i,e)===n)return}else for(var o in e)if(x.has(e,o)&&t.call(r,e[o],o,e)===n)return};x.map=x.collect=function(e,t,n){var r=[];return null==e?r:h&&e.map===h?e.map(t,n):(T(e,function(e,i,s){r[r.length]=t.call(n,e,i,s)}),r)};var N="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(e,t,n,r){var i=arguments.length>2;if(null==e&&(e=[]),p&&e.reduce===p)return r&&(t=x.bind(t,r)),i?e.reduce(t,n):e.reduce(t);if(T(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)}),!i)throw new TypeError(N);return n},x.reduceRight=x.foldr=function(e,t,n,r){var i=arguments.length>2;if(null==e&&(e=[]),d&&e.reduceRight===d)return r&&(t=x.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var s=e.length;if(s!==+s){var o=x.keys(e);s=o.length}if(T(e,function(u,a,f){a=o?o[--s]:--s,i?n=t.call(r,n,e[a],a,f):(n=e[a],i=!0)}),!i)throw new TypeError(N);return n},x.find=x.detect=function(e,t,n){var r;return C(e,function(e,i,s){return t.call(n,e,i,s)?(r=e,!0):void 0}),r},x.filter=x.select=function(e,t,n){var r=[];return null==e?r:v&&e.filter===v?e.filter(t,n):(T(e,function(e,i,s){t.call(n,e,i,s)&&(r[r.length]=e)}),r)},x.reject=function(e,t,n){return x.filter(e,function(e,r,i){return!t.call(n,e,r,i)},n)},x.every=x.all=function(e,t,r){t||(t=x.identity);var i=!0;return null==e?i:m&&e.every===m?e.every(t,r):(T(e,function(e,s,o){return(i=i&&t.call(r,e,s,o))?void 0:n}),!!i)};var C=x.some=x.any=function(e,t,r){t||(t=x.identity);var i=!1;return null==e?i:g&&e.some===g?e.some(t,r):(T(e,function(e,s,o){return i||(i=t.call(r,e,s,o))?n:void 0}),!!i)};x.contains=x.include=function(e,t){return null==e?!1:y&&e.indexOf===y?e.indexOf(t)!=-1:C(e,function(e){return e===t})},x.invoke=function(e,t){var n=u.call(arguments,2),r=x.isFunction(t);return x.map(e,function(e){return(r?t:e[t]).apply(e,n)})},x.pluck=function(e,t){return x.map(e,function(e){return e[t]})},x.where=function(e,t,n){return x.isEmpty(t)?n?null:[]:x[n?"find":"filter"](e,function(e){for(var n in t)if(t[n]!==e[n])return!1;return!0})},x.findWhere=function(e,t){return x.where(e,t,!0)},x.max=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&65535>e.length)return Math.max.apply(Math,e);if(!t&&x.isEmpty(e))return-1/0;var r={computed:-1/0,value:-1/0};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o>=r.computed&&(r={value:e,computed:o})}),r.value},x.min=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&65535>e.length)return Math.min.apply(Math,e);if(!t&&x.isEmpty(e))return 1/0;var r={computed:1/0,value:1/0};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;r.computed>o&&(r={value:e,computed:o})}),r.value},x.shuffle=function(e){var t,n=0,r=[];return T(e,function(e){t=x.random(n++),r[n-1]=r[t],r[t]=e}),r};var k=function(e){return x.isFunction(e)?e:function(t){return t[e]}};x.sortBy=function(e,t,n){var r=k(t);return x.pluck(x.map(e,function(e,t,i){return{value:e,index:t,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||n===void 0)return 1;if(r>n||r===void 0)return-1}return e.index<t.index?-1:1}),"value")};var L=function(e,t,n,r){var i={},s=k(t||x.identity);return T(e,function(t,o){var u=s.call(n,t,o,e);r(i,u,t)}),i};x.groupBy=function(e,t,n){return L(e,t,n,function(e,t,n){(x.has(e,t)?e[t]:e[t]=[]).push(n)})},x.countBy=function(e,t,n){return L(e,t,n,function(e,t){x.has(e,t)||(e[t]=0),e[t]++})},x.sortedIndex=function(e,t,n,r){n=null==n?x.identity:k(n);for(var i=n.call(r,t),s=0,o=e.length;o>s;){var u=s+o>>>1;i>n.call(r,e[u])?s=u+1:o=u}return s},x.toArray=function(e){return e?x.isArray(e)?u.call(e):e.length===+e.length?x.map(e,x.identity):x.values(e):[]},x.size=function(e){return null==e?0:e.length===+e.length?e.length:x.keys(e).length},x.first=x.head=x.take=function(e,t,n){return null==e?void 0:null==t||n?e[0]:u.call(e,0,t)},x.initial=function(e,t,n){return u.call(e,0,e.length-(null==t||n?1:t))},x.last=function(e,t,n){return null==e?void 0:null==t||n?e[e.length-1]:u.call(e,Math.max(e.length-t,0))},x.rest=x.tail=x.drop=function(e,t,n){return u.call(e,null==t||n?1:t)},x.compact=function(e){return x.filter(e,x.identity)};var A=function(e,t,n){return T(e,function(e){x.isArray(e)?t?o.apply(n,e):A(e,t,n):n.push(e)}),n};x.flatten=function(e,t){return A(e,t,[])},x.without=function(e){return x.difference(e,u.call(arguments,1))},x.uniq=x.unique=function(e,t,n,r){x.isFunction(t)&&(r=n,n=t,t=!1);var i=n?x.map(e,n,r):e,s=[],o=[];return T(i,function(n,r){(t?r&&o[o.length-1]===n:x.contains(o,n))||(o.push(n),s.push(e[r]))}),s},x.union=function(){return x.uniq(a.apply(r,arguments))},x.intersection=function(e){var t=u.call(arguments,1);return x.filter(x.uniq(e),function(e){return x.every(t,function(t){return x.indexOf(t,e)>=0})})},x.difference=function(e){var t=a.apply(r,u.call(arguments,1));return x.filter(e,function(e){return!x.contains(t,e)})},x.zip=function(){for(var e=u.call(arguments),t=x.max(x.pluck(e,"length")),n=Array(t),r=0;t>r;r++)n[r]=x.pluck(e,""+r);return n},x.object=function(e,t){if(null==e)return{};for(var n={},r=0,i=e.length;i>r;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},x.indexOf=function(e,t,n){if(null==e)return-1;var r=0,i=e.length;if(n){if("number"!=typeof n)return r=x.sortedIndex(e,t),e[r]===t?r:-1;r=0>n?Math.max(0,i+n):n}if(y&&e.indexOf===y)return e.indexOf(t,n);for(;i>r;r++)if(e[r]===t)return r;return-1},x.lastIndexOf=function(e,t,n){if(null==e)return-1;var r=null!=n;if(b&&e.lastIndexOf===b)return r?e.lastIndexOf(t,n):e.lastIndexOf(t);for(var i=r?n:e.length;i--;)if(e[i]===t)return i;return-1},x.range=function(e,t,n){1>=arguments.length&&(t=e||0,e=0),n=arguments[2]||1;for(var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=Array(r);r>i;)s[i++]=e,e+=n;return s},x.bind=function(e,t){if(e.bind===S&&S)return S.apply(e,u.call(arguments,1));var n=u.call(arguments,2);return function(){return e.apply(t,n.concat(u.call(arguments)))}},x.partial=function(e){var t=u.call(arguments,1);return function(){return e.apply(this,t.concat(u.call(arguments)))}},x.bindAll=function(e){var t=u.call(arguments,1);return 0===t.length&&(t=x.functions(e)),T(t,function(t){e[t]=x.bind(e[t],e)}),e},x.memoize=function(e,t){var n={};return t||(t=x.identity),function(){var r=t.apply(this,arguments);return x.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},x.delay=function(e,t){var n=u.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},x.defer=function(e){return x.delay.apply(x,[e,1].concat(u.call(arguments,1)))},x.throttle=function(e,t){var n,r,i,s,o=0,u=function(){o=new Date,i=null,s=e.apply(n,r)};return function(){var a=new Date,f=t-(a-o);return n=this,r=arguments,0>=f?(clearTimeout(i),i=null,o=a,s=e.apply(n,r)):i||(i=setTimeout(u,f)),s}},x.debounce=function(e,t,n){var r,i;return function(){var s=this,o=arguments,u=function(){r=null,n||(i=e.apply(s,o))},a=n&&!r;return clearTimeout(r),r=setTimeout(u,t),a&&(i=e.apply(s,o)),i}},x.once=function(e){var t,n=!1;return function(){return n?t:(n=!0,t=e.apply(this,arguments),e=null,t)}},x.wrap=function(e,t){return function(){var n=[e];return o.apply(n,arguments),t.apply(this,n)}},x.compose=function(){var e=arguments;return function(){for(var t=arguments,n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},x.after=function(e,t){return 0>=e?t():function(){return 1>--e?t.apply(this,arguments):void 0}},x.keys=E||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)x.has(e,n)&&(t[t.length]=n);return t},x.values=function(e){var t=[];for(var n in e)x.has(e,n)&&t.push(e[n]);return t},x.pairs=function(e){var t=[];for(var n in e)x.has(e,n)&&t.push([n,e[n]]);return t},x.invert=function(e){var t={};for(var n in e)x.has(e,n)&&(t[e[n]]=n);return t},x.functions=x.methods=function(e){var t=[];for(var n in e)x.isFunction(e[n])&&t.push(n);return t.sort()},x.extend=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e},x.pick=function(e){var t={},n=a.apply(r,u.call(arguments,1));return T(n,function(n){n in e&&(t[n]=e[n])}),t},x.omit=function(e){var t={},n=a.apply(r,u.call(arguments,1));for(var i in e)x.contains(n,i)||(t[i]=e[i]);return t},x.defaults=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)null==e[n]&&(e[n]=t[n])}),e},x.clone=function(e){return x.isObject(e)?x.isArray(e)?e.slice():x.extend({},e):e},x.tap=function(e,t){return t(e),e};var O=function(e,t,n,r){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof x&&(e=e._wrapped),t instanceof x&&(t=t._wrapped);var i=f.call(e);if(i!=f.call(t))return!1;switch(i){case"[object String]":return e==t+"";case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if("object"!=typeof e||"object"!=typeof t)return!1;for(var s=n.length;s--;)if(n[s]==e)return r[s]==t;n.push(e),r.push(t);var o=0,u=!0;if("[object Array]"==i){if(o=e.length,u=o==t.length)for(;o--&&(u=O(e[o],t[o],n,r)););}else{var a=e.constructor,l=t.constructor;if(a!==l&&!(x.isFunction(a)&&a instanceof a&&x.isFunction(l)&&l instanceof l))return!1;for(var c in e)if(x.has(e,c)&&(o++,!(u=x.has(t,c)&&O(e[c],t[c],n,r))))break;if(u){for(c in t)if(x.has(t,c)&&!(o--))break;u=!o}}return n.pop(),r.pop(),u};x.isEqual=function(e,t){return O(e,t,[],[])},x.isEmpty=function(e){if(null==e)return!0;if(x.isArray(e)||x.isString(e))return 0===e.length;for(var t in e)if(x.has(e,t))return!1;return!0},x.isElement=function(e){return!!e&&1===e.nodeType},x.isArray=w||function(e){return"[object Array]"==f.call(e)},x.isObject=function(e){return e===Object(e)},T(["Arguments","Function","String","Number","Date","RegExp"],function(e){x["is"+e]=function(t){return f.call(t)=="[object "+e+"]"}}),x.isArguments(arguments)||(x.isArguments=function(e){return!!e&&!!x.has(e,"callee")}),"function"!=typeof /./&&(x.isFunction=function(e){return"function"==typeof e}),x.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},x.isNaN=function(e){return x.isNumber(e)&&e!=+e},x.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==f.call(e)},x.isNull=function(e){return null===e},x.isUndefined=function(e){return e===void 0},x.has=function(e,t){return l.call(e,t)},x.noConflict=function(){return e._=t,this},x.identity=function(e){return e},x.times=function(e,t,n){for(var r=Array(e),i=0;e>i;i++)r[i]=t.call(n,i);return r},x.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))};var M={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};M.unescape=x.invert(M.escape);var _={escape:RegExp("["+x.keys(M.escape).join("")+"]","g"),unescape:RegExp("("+x.keys(M.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(e){x[e]=function(t){return null==t?"":(""+t).replace(_[e],function(t){return M[e][t]})}}),x.result=function(e,t){if(null==e)return null;var n=e[t];return x.isFunction(n)?n.call(e):n},x.mixin=function(e){T(x.functions(e),function(t){var n=x[t]=e[t];x.prototype[t]=function(){var e=[this._wrapped];return o.apply(e,arguments),j.call(this,n.apply(x,e))}})};var D=0;x.uniqueId=function(e){var t=++D+"";return e?e+t:t},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var P=/(.)^/,H={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},B=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(e,t,n){var r;n=x.defaults({},n,x.templateSettings);var i=RegExp([(n.escape||P).source,(n.interpolate||P).source,(n.evaluate||P).source].join("|")+"|$","g"),s=0,o="__p+='";e.replace(i,function(t,n,r,i,u){return o+=e.slice(s,u).replace(B,function(e){return"\\"+H[e]}),n&&(o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),r&&(o+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),i&&(o+="';\n"+i+"\n__p+='"),s=u+t.length,t}),o+="';\n",n.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{r=Function(n.variable||"obj","_",o)}catch(u){throw u.source=o,u}if(t)return r(t,x);var a=function(e){return r.call(this,e,x)};return a.source="function("+(n.variable||"obj")+"){\n"+o+"}",a},x.chain=function(e){return x(e).chain()};var j=function(e){return this._chain?x(e).chain():e};x.mixin(x),T(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];x.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!=e&&"splice"!=e||0!==n.length||delete n[0],j.call(this,n)}}),T(["concat","join","slice"],function(e){var t=r[e];x.prototype[e]=function(){return j.call(this,t.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof define&&define.amd&&define("underscore",[],function(){return x})}.call(this),define("libs/util/Url",[],function(){var e={};return e.getUrlVars=function(){var e={},t,n=window.location.href.slice(window.location.href.indexOf("?")+1).split("&");for(var r=0;r<n.length;r++)t=n[r].split("="),e[t[0]]=t[1];return e},e}),define("libs/util/Rand",[],function(){var e={};return e.getRandomInt=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},e}),typeof module!="undefined"&&module.exports&&(module.exports=printStackTrace),printStackTrace.implementation=function(){},printStackTrace.implementation.prototype={run:function(e,t){return e=e||this.createException(),t=t||this.mode(e),t==="other"?this.other(arguments.callee):this[t](e)},createException:function(){try{this.undef()}catch(e){return e}},mode:function(e){return e.arguments&&e.stack?"chrome":e.stack&&e.sourceURL?"safari":e.stack&&e.number?"ie":typeof e.message=="string"&&typeof window!="undefined"&&window.opera?e.stacktrace?e.message.indexOf("\n")>-1&&e.message.split("\n").length>e.stacktrace.split("\n").length?"opera9":e.stack?e.stacktrace.indexOf("called from line")<0?"opera10b":"opera11":"opera10a":"opera9":e.stack?"firefox":"other"},instrumentFunction:function(e,t,n){e=e||window;var r=e[t];e[t]=function(){return n.call(this,printStackTrace().slice(4)),e[t]._instrumented.apply(this,arguments)},e[t]._instrumented=r},deinstrumentFunction:function(e,t){e[t].constructor===Function&&e[t]._instrumented&&e[t]._instrumented.constructor===Function&&(e[t]=e[t]._instrumented)},chrome:function(e){var t=(e.stack+"\n").replace(/^\S[^\(]+?[\n$]/gm,"").replace(/^\s+(at eval )?at\s+/gm,"").replace(/^([^\(]+?)([\n$])/gm,"{anonymous}()@$1$2").replace(/^Object.<anonymous>\s*\(([^\)]+)\)/gm,"{anonymous}()@$1").split("\n");return t.pop(),t},safari:function(e){return e.stack.replace(/\[native code\]\n/m,"").replace(/^(?=\w+Error\:).*$\n/m,"").replace(/^@/gm,"{anonymous}()@").split("\n")},ie:function(e){var t=/^.*at (\w+) \(([^\)]+)\)$/gm;return e.stack.replace(/at Anonymous function /gm,"{anonymous}()@").replace(/^(?=\w+Error\:).*$\n/m,"").replace(t,"$1@$2").split("\n")},firefox:function(e){return e.stack.replace(/(?:\n@:0)?\s+$/m,"").replace(/^[\(@]/gm,"{anonymous}()@").split("\n")},opera11:function(e){var t="{anonymous}",n=/^.*line (\d+), column (\d+)(?: in (.+))? in (\S+):$/,r=e.stacktrace.split("\n"),i=[];for(var s=0,o=r.length;s<o;s+=2){var u=n.exec(r[s]);if(u){var a=u[4]+":"+u[1]+":"+u[2],f=u[3]||"global code";f=f.replace(/<anonymous function: (\S+)>/,"$1").replace(/<anonymous function>/,t),i.push(f+"@"+a+" -- "+r[s+1].replace(/^\s+/,""))}}return i},opera10b:function(e){var t=/^(.*)@(.+):(\d+)$/,n=e.stacktrace.split("\n"),r=[];for(var i=0,s=n.length;i<s;i++){var o=t.exec(n[i]);if(o){var u=o[1]?o[1]+"()":"global code";r.push(u+"@"+o[2]+":"+o[3])}}return r},opera10a:function(e){var t="{anonymous}",n=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,r=e.stacktrace.split("\n"),i=[];for(var s=0,o=r.length;s<o;s+=2){var u=n.exec(r[s]);if(u){var a=u[3]||t;i.push(a+"()@"+u[2]+":"+u[1]+" -- "+r[s+1].replace(/^\s+/,""))}}return i},opera9:function(e){var t="{anonymous}",n=/Line (\d+).*script (?:in )?(\S+)/i,r=e.message.split("\n"),i=[];for(var s=2,o=r.length;s<o;s+=2){var u=n.exec(r[s]);u&&i.push(t+"()@"+u[2]+":"+u[1]+" -- "+r[s+1].replace(/^\s+/,""))}return i},other:function(e){var t="{anonymous}",n=/function\s*([\w\-$]+)?\s*\(/i,r=[],i,s,o=10;while(e&&e.arguments&&r.length<o)i=n.test(e.toString())?RegExp.$1||t:t,s=Array.prototype.slice.call(e.arguments||[]),r[r.length]=i+"("+this.stringifyArguments(s)+")",e=e.caller;return r},stringifyArguments:function(e){var t=[],n=Array.prototype.slice;for(var r=0;r<e.length;++r){var i=e[r];i===undefined?t[r]="undefined":i===null?t[r]="null":i.constructor&&(i.constructor===Array?i.length<3?t[r]="["+this.stringifyArguments(i)+"]":t[r]="["+this.stringifyArguments(n.call(i,0,1))+"..."+this.stringifyArguments(n.call(i,-1))+"]":i.constructor===Object?t[r]="#object":i.constructor===Function?t[r]="#function":i.constructor===String?t[r]='"'+i+'"':i.constructor===Number&&(t[r]=i))}return t.join(",")},sourceCache:{},ajax:function(e){var t=this.createXMLHTTPObject();if(t)try{return t.open("GET",e,!1),t.send(null),t.responseText}catch(n){}return""},createXMLHTTPObject:function(){var e,t=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];for(var n=0;n<t.length;n++)try{return e=t[n](),this.createXMLHTTPObject=t[n],e}catch(r){}},isSameDomain:function(e){return typeof location!="undefined"&&e.indexOf(location.hostname)!==-1},getSource:function(e){return e in this.sourceCache||(this.sourceCache[e]=this.ajax(e).split("\n")),this.sourceCache[e]},guessAnonymousFunctions:function(e){for(var t=0;t<e.length;++t){var n=/\{anonymous\}\(.*\)@(.*)/,r=/^(.*?)(?::(\d+))(?::(\d+))?(?: -- .+)?$/,i=e[t],s=n.exec(i);if(s){var o=r.exec(s[1]);if(o){var u=o[1],a=o[2],f=o[3]||0;if(u&&this.isSameDomain(u)&&a){var l=this.guessAnonymousFunction(u,a,f);e[t]=i.replace("{anonymous}",l)}}}}return e},guessAnonymousFunction:function(e,t,n){var r;try{r=this.findFunctionName(this.getSource(e),t)}catch(i){r="getSource failed with url: "+e+", exception: "+i.toString()}return r},findFunctionName:function(e,t){var n=/function\s+([^(]*?)\s*\(([^)]*)\)/,r=/['"]?([$_A-Za-z][$_A-Za-z0-9]*)['"]?\s*[:=]\s*function\b/,i=/['"]?([$_A-Za-z][$_A-Za-z0-9]*)['"]?\s*[:=]\s*(?:eval|new Function)\b/,s="",o,u=Math.min(t,20),a,f;for(var l=0;l<u;++l){o=e[t-l-1],f=o.indexOf("//"),f>=0&&(o=o.substr(0,f));if(o){s=o+s,a=r.exec(s);if(a&&a[1])return a[1];a=n.exec(s);if(a&&a[1])return a[1];a=i.exec(s);if(a&&a[1])return a[1]}}return"(?)"}},define("libs/stacktrace",function(){}),define("libs/util/Logger",["libs/stacktrace"],function(){var e={logSettings:{debug:!1,debugLevel:1},logObjectName:"",log:function(e,t,n){if(this.logSettings.debug&&typeof console!="undefined"&&t<=this.logSettings.debugLevel){var r="";this.cid!=undefined?r=this.logObjectName+"[ "+this.cid+" ]."+e:r=this.logObjectName+"."+e,n!=undefined&&n!=""&&n!=null?n instanceof Error?(console.log(r+": ERROR: "+n),console.log(r+": STACKTRACE:"),console.log(printStackTrace({e:n}).join("\n\n"))):console.log(r+": "+n):console.log(r)}}};return e}),define("libs/springfield/bart/BartConnector",["underscore","libs/util/Rand","libs/util/Logger"],function(e,t,n){function r(r){e.extend(this,n),this.logObjectName="BartConnector";var i=this,s={bartURI:"http://bart%number%.noterik.com/bart/",bart:t.getRandomInt(1,3)};return this.request=function(e){this.log("request()",1),e.url=s.bartURI+e.url,$.ajax(e)},e.extend(s,r),this.log("constructor()",1),s.bartURI=s.bartURI.replace("%number%",s.bart),i}return r}),define("libs/springfield/bart/QuickStartConnector",["underscore","libs/springfield/bart/BartConnector","libs/util/Logger"],function(e,t,n){function r(r){e.extend(this,n);var i={success:null,uri:null};this.logObjectName="QuickstartConnector";var s=t(),o={url:null,type:"POST",accepts:"text/xml",contentType:"text/xml",data:"<fsxml mimetype='application/fscommand' id='dynamic'><properties><handler>/dynamic/presentation/playout/flash</handler></properties></fsxml>"},u=function(){this.log("validate()",3);if(i.uri==null)throw"No URI given!";return!0},a=function(){this.log("request()",1),typeof i.success=="function"&&(o.success=i.success),s.request(o)};e.extend(i,r),o.url=i.uri,u(),a()}return r}),define("libs/util/AspectRatio",[],function(){var e={};return e.getAspectRatio=function(e,t){return e/t>=1.2&&e/t<=1.5?"4:3":e/t>=1.5&&e/t<=2.1?"16:9":e/t>=2.1&&e/t<=2.7?"2.35":"unknown"},e}),define("libs/krusty5-core/bart/QSResponseParser",["underscore","libs/util/Logger","libs/util/AspectRatio"],function(e,t,n){var r={};return e.extend(r,t),r.logObjectName="QSResponseParser",r.parse=function(t){this.log("parse()",1);var r=[],i=$(t);return e.each(i.find("presentation > videoplaylist").first().find("video"),function(t){var s={};s.sources=[],t=$(t),t.find("starttime")!=null?s.start=$(t.find("starttime")).text()/1e3:s.start=0;if(t.find("duration")!=null){var o=0;s.start!=undefined&&(o=s.start),s.stop=o+$(t.find("duration")).text()/1e3}var u=$(i.find('fsxml > video[fullid|="'+t.attr("referid")+'"]'));u.find("properties > anamorphic").text()=="1.33"&&(s.anamorphic=!0);var a="16:9",f=$(e.find($(i.find('fsxml > video[fullid|="'+t.attr("referid")+'"] > rawvideo')),function(e){return $(e).find("original").first().text()=="true"}));f!=null&&(a=n.getAspectRatio(f.find("width").text(),f.find("height").text()),a!=null&&s.anamorphic&&(a=="4:3"?a="4:3ana16:9":a=="16:9"&&(a="16:9ana2.35"))),s.aspectRatio=a;if(u.children("rawvideo").length>1)e.each(u.children("rawvideo"),function(t){if(!$(t).find("original").text()&&$(t).find("wantedheight").text()!=""){var n=!1,r=e.find(s.sources,function(e){return e.quality==$(t).find("wantedheight").text()});if(r==null){var n=!0;r={}}r.quality=$(t).find("height").text()+"p",r.codecs==undefined&&(r.codecs=[]);var i={};switch($(t).find("extension").text()){case"mp4":i.type="video/mp4"}var o=$(t).find("mount").text().split(",")[0];i.src="http://c7.noterik.com/"+o+u.attr("fullid")+"/rawvideo/"+$(t).attr("id")+"/raw.mp4",r.codecs.push(i),n&&s.sources.push(r)}else $(t).find("mount").text()=="youtube"&&(s.type="video/youtube",s.youtubeid=$(t).find("id").text(),s.availableQualities=["360p","480p","720p"])});else{var l=u.find("rawvideo").first(),c={};c.quality="720",c.codecs=[];var h={};switch($(l).find("extension").text()){case"mp4":h.type="video/mp4"}var p=$(l).find("mount").text().split(",")[0];h.src="http://c7.noterik.com/"+p+u.attr("fullid")+"/rawvideo/"+$(l).attr("id")+"/raw.mp4",c.codecs.push(h),s.sources.push(c)}var d=u.find("screens").first();s.screenshots=d.find("uri").text(),r.push(s)}),r},r}),define("libs/springfield/bart/BartResponseParser",["underscore"],function(e){function t(t){var n={nic:null,response:null,uri:null},r=function(e,t){t==null&&(t=n.uri),e.children().each(function(e,i){if(i.nodeName=="properties")$(i).children().each(function(e,r){var i=r.nodeName;n.nic.put(t+"/properties/"+i,$(r).text())});else{var s=i.nodeName,o=$(i).attr("id");o==undefined&&(o=""),n.nic.put(t+"/"+s,null),n.nic.put(t+"/"+s+"/"+o,null),r($(i),t+"/"+s+"/"+o)}})};return e.extend(n,t),{parse:function(){n.response instanceof jQuery||(n.response=$(n.response));var e=n.response.find("fsxml");if(e==null)throw"Response does not contain fsxml.";r(n.response.find("fsxml"),null)}}}return t}),define("libs/tmpl",[],function(){var e=function(){var e={};this.tmpl=function t(n,r){var i=/\W/.test(n)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+n.replace(/[\r\t\n]/g," ").split("<%").join("	").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"):e[n]=e[n]||t(document.getElementById(n).innerHTML);return r?i(r):i}},t=new e;return t.tmpl}),function(){var e=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],t=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,n=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,r=typeof location!="undefined"&&location.href,i=r&&location.protocol&&location.protocol.replace(/\:/,""),s=r&&location.hostname,o=r&&(location.port||void 0),u=[];define("libs/text",[],function(){var a,f,l;return typeof window!="undefined"&&window.navigator&&window.document?f=function(e,t){var n=a.createXhr();n.open("GET",e,!0),n.onreadystatechange=function(){n.readyState===4&&t(n.responseText)},n.send(null)}:typeof process!="undefined"&&process.versions&&process.versions.node?(l=require.nodeRequire("fs"),f=function(e,t){t(l.readFileSync(e,"utf8"))}):typeof Packages!="undefined"&&(f=function(e,t){var n=new java.io.File(e),r=java.lang.System.getProperty("line.separator"),n=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(n),"utf-8")),i,s,o="";try{i=new java.lang.StringBuffer,(s=n.readLine())&&s.length()&&s.charAt(0)===65279&&(s=s.substring(1));for(i.append(s);(s=n.readLine())!==null;)i.append(r),i.append(s);o=String(i.toString())}finally{n.close()}t(o)}),a={version:"1.0.2",strip:function(e){if(e){var e=e.replace(t,""),r=e.match(n);r&&(e=r[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r")},createXhr:function(){var t,n,r;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;for(n=0;n<3;n++){r=e[n];try{t=new ActiveXObject(r)}catch(i){}if(t){e=[r];break}}if(!t)throw Error("createXhr(): XMLHttpRequest not available");return t},get:f,parseName:function(e){var t=!1,n=e.indexOf("."),r=e.substring(0,n),e=e.substring(n+1,e.length),n=e.indexOf("!");return n!==-1&&(t=e.substring(n+1,e.length),t=t==="strip",e=e.substring(0,n)),{moduleName:r,ext:e,strip:t}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,t,n,r){var i=a.xdRegExp.exec(e),s;return i?(e=i[2],i=i[3],i=i.split(":"),s=i[1],i=i[0],(!e||e===t)&&(!i||i===n)&&(!s&&!i||s===r)):!0},finishLoad:function(e,t,n,r,i){n=t?a.strip(n):n,i.isBuild&&(u[e]=n),r(n)},load:function(e,t,n,u){if(u.isBuild&&!u.inlineText)n();else{var f=a.parseName(e),l=f.moduleName+"."+f.ext,c=t.toUrl(l),h=u&&u.text&&u.text.useXhr||a.useXhr;!r||h(c,i,s,o)?a.get(c,function(t){a.finishLoad(e,f.strip,t,n,u)}):t([l],function(e){a.finishLoad(f.moduleName+"."+f.ext,f.strip,e,n,u)})}},write:function(e,t,n){if(t in u){var r=a.jsEscape(u[t]);n.asModule(e+"!"+t,"define(function () { return '"+r+"';});\n")}},writeFile:function(e,t,n,r,i){var t=a.parseName(t),s=t.moduleName+"."+t.ext,o=n.toUrl(t.moduleName+"."+t.ext)+".js";a.load(s,n,function(){var t=function(e){return r(o,e)};t.asModule=function(e,t){return r.asModule(e,o,t)},a.write(e,s,t,i)},i)}}})}(),define("libs/text!libs/krusty5-gui/templates/gui.component.template.html",[],function(){return"&nbsp;"}),define("libs/krusty5-gui/GUIComponentBase",["libs/tmpl","libs/util/Logger","libs/text!libs/krusty5-gui/templates/gui.component.template.html"],function(e,t,n){function r(t){var r={element:$(document.createElement("div")),template:n,context:null,children:[],parent:null,templateContents:{},imgLocation:""};return _.extend(r,t),{getElement:function(){return r.element},setDimensions:function(e){r.element.width(e.width),r.element.height(e.height)},getDimensions:function(){return{width:r.element.width(),height:r.element.height()}},setTemplate:function(e){r.template=e},getTemplate:function(){return r.template},setTemplateContents:function(e){r.templateContents=e},getTemplateContents:function(){return r.templateContents},setTmplValue:function(e,t){r.templateContents[e]=t},setContext:function(e){r.context=e},getContext:function(e){return r.context},getImgLocation:function(){return r.imgLocation},setParent:function(e){r.parent=e},getParent:function(){return r.parent},addChild:function(e){r.children[r.children.length]=e},getChildren:function(e){return e!=null?$(_.filter(r.children,function(t){return t.getElement().is(e)})):r.children},render:function(){r.element.html(e(r.template,r.templateContents))},contextReady:function(){},on:function(e,t){r.element.on(e,t)},trigger:function(e){r.element.trigger(e)},show:function(){r.element.show()},hide:function(){r.element.hide()},isVisible:function(){return r.element.is(":visible")},width:function(e){return r.element.width.apply(r.element,arguments)},height:function(e){return r.element.height.apply(r.element,arguments)},css:function(){return r.element.css.apply(r.element,arguments)}}}return r}),define("libs/text!libs/krusty5-gui/templates/gui.component.presentation.template.html",[],function(){return'<div class="viewport">\n</div>\n<div class="screenshot-mask">\n</div>\n<div class="controls">\n	&nbsp;\n</div>\n<div id="youtube-container">\n	<div id="youtube-player">&nbsp;</div>\n</div>\n'}),define("libs/krusty5-gui/GUIPresentation",["libs/krusty5-gui/GUIComponentBase","libs/text!libs/krusty5-gui/templates/gui.component.presentation.template.html"],function(e,t){function n(n){return self=e(n),self.setTemplate(t),self.contextReady=function(){this.getChildren(".viewport")[0].setHeightOffset(this.getChildren(".controls")[0].getDimensions().height),this.getContext().get(".screenshot-mask")[0].setHeightOffset(this.getChildren(".controls")[0].getDimensions().height)},self.resize=function(){this.getChildren(".viewport")[0].setHeightOffset(this.getChildren(".controls")[0].getDimensions().height),this.getContext().get(".screenshot-mask")[0].setHeightOffset(this.getChildren(".controls")[0].getDimensions().height)},self}return n}),define("libs/krusty5-gui/GUIScalableMaskComponent",["libs/krusty5-gui/GUIComponentBase","libs/util/AspectRatio"],function(e,t){function n(n){var r=e(n),i={pHeight:0,pWidth:0,displayArea:null,heightOffset:0,widthOffset:0,mode:"auto",inputRenderingMapping:{"4:3ana16:9":"_render43Anamorphic",unknown:"_render169","16:9":"_render169","4:3":"_render43",2.35:"_render235","16:9ana2.35":"_render169Anamorphic"},wantedRatio:"16:9",givenRatio:"16:9"};r.setWantedRatio=function(e){e!=null&&(i.wantedRatio=e),this.resize()},r.getWantedRatio=function(){return i.wantedRatio},r.setGivenRatio=function(e){i.givenRatio=e},r.getGivenRatio=function(){return i.givenRatio},r.setHeightOffset=function(e){i.heightOffset=e},r.getHeightOffset=function(){return i.heightOffset},r.setWidthOffset=function(e){i.widthOffset=e},r.getWidthOffset=function(){return i.widthOffset},r.setMode=function(e){i.mode=e},r.getMode=function(){return i.mode},r.setDisplayArea=function(e){i.displayArea=e},r.getDisplayArea=function(){return i.displayArea},r.resize=function(){i.pHeight=this.getElement().parent().height()-i.heightOffset,i.pWidth=this.getElement().parent().width()-i.widthOffset,i.displayArea!=null&&(i.mode=="auto"?this[i.inputRenderingMapping[i.wantedRatio]]():o())};var s=function(){r.getElement().css("position","absolute"),r.getElement().css("left",0),r.getElement().css("top",0),r.getElement().css("bottom",0),i.displayArea.css("position","absolute"),i.displayArea.css("left",0),i.displayArea.css("top",0),i.displayArea.css("bottom",0)},o=function(){s(),r.getElement().height(i.pHeight),r.getElement().width(i.pWidth),i.displayArea.width(i.pWidth),i.displayArea.height(i.pHeight)};return r._render43Anamorphic=function(){switch(t.getAspectRatio(i.pWidth,i.pHeight)){case"4:3":s(),this.getElement().width(i.pWidth),this.getElement().height(i.pWidth/16*9),this.getElement().css("top",(i.pHeight-this.getElement().height())/2),i.displayArea.width(i.pWidth),i.displayArea.height(i.pWidth/4*3),i.displayArea.css("top",-(i.displayArea.height()-this.getElement().height())/2);break;case"16:9":s(),this.getElement().height(i.pHeight),this.getElement().width(i.pWidth),i.displayArea.width(i.pWidth),i.displayArea.height(i.pHeight*1.33),i.displayArea.css("top",-(i.displayArea.height()-this.getElement().height())/2);break;case"2.35":s(),this.getElement().width(i.pHeight/9*16),this.getElement().height(i.pHeight),this.getElement().css("left",(i.pWidth-this.getElement().width())/2),i.displayArea.width(this.getElement().width()),i.displayArea.height(i.pHeight*1.33),i.displayArea.css("top",-(i.displayArea.height()-this.getElement().height())/2);break;case"unknown":s(),this.getElement().height(i.pHeight),this.getElement().width(i.pWidth),i.displayArea.width(i.pWidth),i.displayArea.height(i.pHeight)}},r._render169=function(){switch(t.getAspectRatio(i.pWidth,i.pHeight)){case"4:3":s(),this.getElement().width(i.pWidth),this.getElement().height(i.pWidth/16*9),this.getElement().css("top",(i.pHeight-this.getElement().height())/2),i.displayArea.width(this.getElement().width()),i.displayArea.height(this.getElement().height());break;case"16:9":s(),this.getElement().width(i.pWidth),this.getElement().height(i.pHeight),i.displayArea.width(i.pWidth),i.displayArea.height(i.pHeight);break;case"2.35":s(),this.getElement().height(i.pHeight),this.getElement().width(i.pHeight/9*16),this.getElement().css("left",(i.pWidth-this.getElement().width())/2),i.displayArea.width(i.pHeight/9*16),i.displayArea.height(i.pHeight);break;case"unknown":s(),this.getElement().height(i.pHeight),this.getElement().width(i.pWidth),i.displayArea.width(i.pWidth),i.displayArea.height(i.pHeight)}},r._render43=function(){switch(t.getAspectRatio(i.pWidth,i.pHeight)){case"4:3":s(),this.getElement().width(i.pWidth),this.getElement().height(i.pHeight),i.displayArea.height(i.pHeight),i.displayArea.width(i.pWidth);break;case"16:9":s(),this.getElement().width(i.pHeight/3*4),this.getElement().height(i.pHeight),this.getElement().css("left",(i.pWidth-this.getElement().width())/2),i.displayArea.width(this.getElement().width()),i.displayArea.height(this.getElement().height());break;case"2.35":s(),this.getElement().width(i.pHeight/3*4),this.getElement().height(i.pHeight),this.getElement().css("left",(i.pWidth-this.getElement().width())/2),i.displayArea.width(this.getElement().width()),i.displayArea.height(this.getElement().height());break;case"unknown":s(),this.getElement().width(i.pWidth),this.getElement().height(i.pHeight),i.displayArea.width(i.pWidth),i.displayArea.height(i.pHeight)}},r._render169Anamorphic=function(){switch(t.getAspectRatio(i.pWidth,i.pHeight)){case"4:3":s(),this.getElement().height(i.pWidth/16*9/1.33),this.getElement().width(i.pWidth),this.getElement().css("top",(i.pHeight-this.getElement().height())/2),i.displayArea.width(i.pWidth),i.displayArea.height(i.pWidth/16*9),i.displayArea.css("top",-(i.displayArea.height()-this.getElement().height())/2);break;case"16:9":s(),this.getElement().height(i.pWidth/2.35),this.getElement().width(i.pWidth);var e=(i.pHeight-this.getElement().height())/2;this.getElement().css("top",e),i.displayArea.width(i.pWidth),i.displayArea.height(i.pHeight),i.displayArea.css("top",-(i.displayArea.height()-this.getElement().height())/2);break;case"2.35":s(),this.getElement().height(i.pHeight),this.getElement().width(i.pWidth),i.displayArea.width(i.pWidth),i.displayArea.height(i.pHeight*1.33),i.displayArea.css("top",-(i.displayArea.height()-this.getElement().height())/2);break;case"unknown":s(),this.getElement().height(i.pHeight),this.getElement().width(i.pWidth),i.displayArea.width(i.pWidth),i.displayArea.height(i.pHeight)}},r._render235=function(){switch(t.getAspectRatio(i.pWidth,i.pHeight)){case"4:3":s(),this.getElement().width(i.pWidth),this.getElement().height(i.pWidth/2.35),this.getElement().css("top",(i.pHeight-this.getElement().height())/2),i.displayArea.width(i.pWidth),i.displayArea.height(i.pWidth/2.35),i.displayArea.css("top",-(i.displayArea.height()-this.getElement().height())/2);break;case"16:9":s(),this.getElement().width(i.pWidth),this.getElement().height(i.pWidth/2.35),this.getElement().css("top",(i.pHeight-this.getElement().height())/2),i.displayArea.width(i.pWidth),i.displayArea.height(i.pWidth/2.35),i.displayArea.css("top",-(i.displayArea.height()-this.getElement().height())/2);break;case"2.35":s(),this.getElement().height(i.pHeight),this.getElement().width(i.pWidth),i.displayArea.width(i.pWidth),i.displayArea.height(i.pHeight);break;case"unknown":s(),this.getElement().height(i.pHeight),this.getElement().width(i.pWidth),i.displayArea.width(i.pWidth),i.displayArea.height(i.pHeight)}},r}return n}),define("libs/text!libs/krusty5-gui/templates/gui.component.viewport.template.html",[],function(){return'<div class="dialog" id="dialog">\n</div>\n<div class="playback">\n</div>\n'}),define("libs/krusty5-gui/GUIViewport",["libs/krusty5-gui/GUIScalableMaskComponent","libs/text!libs/krusty5-gui/templates/gui.component.viewport.template.html"],function(e,t){function n(n){var r=e(n);return r.setTemplate(t),r.contextReady=function(){this.setDisplayArea(this.getChildren(".playback")[0])},r}return n}),define("libs/text!libs/krusty5-gui/templates/gui.component.controls.template.html",[],function(){return'<div class="control-bar">\n	<div id="play-button" class="button button-size-small button-icon-play button-toggled-icon-pause">\n		&nbsp;\n	</div>\n	<div id="volume-button" class="button button-size-small button-icon-volume button-toggled-icon-mute">\n		&nbsp;\n	</div>\n	<div class="scrubber">\n		&nbsp;\n	</div>\n	<div id="quality-button" class="button button-size-large button-icon-360p">\n		&nbsp;\n	</div>\n</div>\n<div id="progress-indicator" class="progress-indicator">\n	&nbsp;\n</div>\n<div id="quality-selector" class="quality-selector">\n	&nbsp;\n</div>\n<div id="volume-control" class="volume-control">\n	&nbsp;\n</div>\n<div class="timer">\n	&nbsp;\n</div>'}),define("libs/krusty5-gui/GUIControls",["libs/krusty5-gui/GUIComponentBase","libs/text!libs/krusty5-gui/templates/gui.component.controls.template.html"],function(e,t){function n(n){return self=e(n),self.setTemplate(t),self.contextReady=function(){var e=this.getChildren("#play-button")[0],t=this.getChildren("#volume-button")[0],n=this.getChildren("#quality-button")[0],r=this.getChildren("#quality-selector")[0],i=this.getChildren("#volume-control")[0],s=this,o=null,u=null;this.setQuality=function(e){var t={"180p":{cls:"button-icon-180p",img:"button-icons/180p.png"},"360p":{cls:"button-icons-360p",img:"button-icons/360p.png"},"480p":{cls:"button-icons-480p",img:"button-icons/480p.png"},"720p":{cls:"button-icons-720p",img:"button-icons/720p.png"},"1080p":{cls:"button-icon-1080p",img:"button-icons/1080p.png"}},r=n.getElement();r.removeClass(r.attr("class").substring(r.attr("class").match(/\bbutton-icon/).index).split(" ")[0]),r.addClass(t[e].cls),r.find("img").attr("src",self.getImgLocation()+t[e].img)},this.hide=function(){u=this.getElement().height(),this.getElement().height(0),this.getElement().hide(),this.getContext().resize()},this.show=function(){this.getElement().height(u),this.getElement().show(),this.getContext().resize()},e.on("click",function(){e.isToggled()?s.trigger("pause-button-clicked"):s.trigger("play-button-clicked"),e.toggle()}),t.on("click",function(){t.isToggled()?s.trigger("unmute-button-clicked"):s.trigger("mute-button-clicked"),t.toggle()}),t.on("mouseover",function(){i.isVisible()||(i.show(),clearTimeout(o))}),t.on("mouseleave",function(){o=setTimeout(function(){i.hasFocus()||i.hide()},1e3)}),n.on("click",function(){r.show(),s.trigger("quality-button-clicked")}),$(window).on("click",function(e){$(e.target).parent().parent().attr("id")!="quality-button"&&r.hide()})},this.getElement().on("touchstart",function(e){e.preventDefault()}),self}return n}),define("libs/text!libs/krusty5-gui/templates/gui.component.screenshot.template.html",[],function(){return"<img />"}),define("libs/krusty5-gui/GUIScreenshot",["libs/krusty5-gui/GUIComponentBase","libs/text!libs/krusty5-gui/templates/gui.component.screenshot.template.html"],function(e,t){function n(n){var r=e(n);r.setTemplate(t);var i,s=document.createElement("img"),o=!1;return r.setScreenshot=function(e){s.src=e;var t=this;o||(blockResize=!0,setTimeout(function(){o=!1},100),$(s).load(function(){i=s,t.getElement().html(i),t._resizeScreenshot()}))},r._resizeScreenshot=function(){var e=r.getDimensions().height,t=r.getDimensions().width;$(i).width(t),$(i).height(e)},r.resize=function(){this._resizeScreenshot()},r}return n}),define("libs/text!libs/krusty5-gui/templates/gui.component.playback.template.html",[],function(){return"&nbsp;"}),define("libs/krusty5-gui/GUIPlayback",["libs/krusty5-gui/GUIComponentBase","libs/text!libs/krusty5-gui/templates/gui.component.playback.template.html"],function(e,t){function n(n){var r=this;return $.extend(r,new e(n)),r.setTemplate(t),r.setVideoElement=function(e){$(this.getElement()).find("video").length>0&&$(this.getElement()).find("video").first().detach(),$(this.getElement()).html(e[0]),this._resizeVideoElement()},r._resizeVideoElement=function(){var e=this,t=$(this.getElement()).find("video, iframe").first();if(t.length>0){var n=function(){var r=e.getDimensions().height,i=e.getDimensions().width;if(t[0].tagName=="VIDEO")if(t[0].readyState>0){t.attr("height",t[0].videoHeight),t.attr("width",t[0].videoWidth);var s=t[0].videoHeight,o=t[0].videoWidth,u=i/o,a=r/s,f=o*u,l=s*a;t.css("transform","scale("+u+", "+a+")"),t.css("transform-origin","0 0"),t.css("-webkit-transform","scale("+u+", "+a+")"),t.css("-webkit-transform-origin","0 0"),t.css("-moz-transform","scale("+u+", "+a+")"),t.css("-moz-transform-origin","0 0"),t.css("-ms-transform","scale("+u+", "+a+")"),t.css("-ms-transform-origin","0 0"),t.css("-o-transform","scale("+u+", "+a+")"),t.css("-o-transform-origin","0 0")}else t.on("loadedmetadata",n);else t[0].tagName=="IFRAME"&&(t.attr("width",i),t.attr("height",r))};n()}},r.resize=function(){this._resizeVideoElement()},r}return n}),define("libs/text!libs/krusty5-gui/templates/gui.component.dialog.template.html",[],function(){return'<div class="indicator">\n	<img src="" />\n</div>\n<div class="message">\n	<span>&nbsp;</span>\n</div>'}),define("libs/krusty5-gui/GUIDialog",["libs/krusty5-gui/GUIComponentBase","libs/text!libs/krusty5-gui/templates/gui.component.dialog.template.html"],function(e,t){function n(n){self=e(n),self.setTemplate(t);var r=null,i={play:{src:"dialog-icons/play.png",width:50,height:50},loading:{src:"dialog-icons/ajax-loader.gif",width:32,height:32},error:{src:"",width:32,height:32}},s=null,o=null,u=null;return self.contextReady=function(){o=this.getElement().find(".indicator"),u=this.getElement().find(".message");var e=this;o.on("click",function(){e.getContext().trigger("click",e)})},self._renderIndicator=function(){var e=o.find("img");e[0].src=self.getImgLocation()+r.src,e[0].width=r.width==undefined?o.width():r.width,e[0].height=r.height==undefined?o.height():r.height,e[0].width<o.width()&&$(e[0]).css("left",(o.width()-e[0].width)/2),e[0].height<o.height()&&$(e[0]).css("top",(o.height()-e[0].height)/2)},self.setIndicator=function(e){s=e,i[e]!=null&&(r=i[e]),this._renderIndicator()},self.getState=function(){return s},self.setMessage=function(e){var t=document.createElement("span");$(t).html(e),u.html(t)},self}return n}),define("libs/text!libs/krusty5-gui/templates/gui.component.scrubber.template.html",[],function(){return'<div class="scrubber-position-wrapper">\n	\n	<!--<div data-role="fieldcontain">\n		<input type="range" name="slider" id="slider-0" value="0" min="0" max="1000" step="100" data-highlight="true"/>\n	</div>-->\n	<div class="slider"></div>\n</div>'}),function(e,t){function n(t,n){var i,s,o,u=t.nodeName.toLowerCase();return"area"===u?(i=t.parentNode,s=i.name,!t.href||!s||i.nodeName.toLowerCase()!=="map"?!1:(o=e("img[usemap=#"+s+"]")[0],!!o&&r(o))):(/input|select|textarea|button|object/.test(u)?!t.disabled:"a"===u?t.href||n:n)&&r(t)}function r(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter(function(){return e.css(this,"visibility")==="hidden"}).length}var i=0,s=/^ui-id-\d+$/;e.ui=e.ui||{};if(e.ui.version)return;e.extend(e.ui,{version:"1.10.1",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({_focus:e.fn.focus,focus:function(t,n){return typeof t=="number"?this.each(function(){var r=this;setTimeout(function(){e(r).focus(),n&&n.call(r)},t)}):this._focus.apply(this,arguments)},scrollParent:function(){var t;return e.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?t=this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.css(this,"position"))&&/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0):t=this.parents().filter(function(){return/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!t.length?e(document):t},zIndex:function(n){if(n!==t)return this.css("zIndex",n);if(this.length){var r=e(this[0]),i,s;while(r.length&&r[0]!==document){i=r.css("position");if(i==="absolute"||i==="relative"||i==="fixed"){s=parseInt(r.css("zIndex"),10);if(!isNaN(s)&&s!==0)return s}r=r.parent()}}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++i)})},removeUniqueId:function(){return this.each(function(){s.test(this.id)&&e(this).removeAttr("id")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(n){return!!e.data(n,t)}}):function(t,n,r){return!!e.data(t,r[3])},focusable:function(t){return n(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var r=e.attr(t,"tabindex"),i=isNaN(r);return(i||r>=0)&&n(t,!i)}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(n,r){function i(t,n,r,i){return e.each(s,function(){n-=parseFloat(e.css(t,"padding"+this))||0,r&&(n-=parseFloat(e.css(t,"border"+this+"Width"))||0),i&&(n-=parseFloat(e.css(t,"margin"+this))||0)}),n}var s=r==="Width"?["Left","Right"]:["Top","Bottom"],o=r.toLowerCase(),u={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+r]=function(n){return n===t?u["inner"+r].call(this):this.each(function(){e(this).css(o,i(this,n)+"px")})},e.fn["outer"+r]=function(t,n){return typeof t!="number"?u["outer"+r].call(this,t):this.each(function(){e(this).css(o,i(this,t,!0,n)+"px")})}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(e==null?this.prevObject:this.prevObject.filter(e))}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=function(t){return function(n){return arguments.length?t.call(this,e.camelCase(n)):t.call(this)}}(e.fn.removeData)),e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),e.support.selectstart="onselectstart"in document.createElement("div"),e.fn.extend({disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),e.extend(e.ui,{plugin:{add:function(t,n,r){var i,s=e.ui[t].prototype;for(i in r)s.plugins[i]=s.plugins[i]||[],s.plugins[i].push([n,r[i]])},call:function(e,t,n){var r,i=e.plugins[t];if(!i||!e.element[0].parentNode||e.element[0].parentNode.nodeType===11)return;for(r=0;r<i.length;r++)e.options[i[r][0]]&&i[r][1].apply(e.element,n)}},hasScroll:function(t,n){if(e(t).css("overflow")==="hidden")return!1;var r=n&&n==="left"?"scrollLeft":"scrollTop",i=!1;return t[r]>0?!0:(t[r]=1,i=t[r]>0,t[r]=0,i)}})}(jQuery),function(e,t){var n=0,r=Array.prototype.slice,i=e.cleanData;e.cleanData=function(t){for(var n=0,r;(r=t[n])!=null;n++)try{e(r).triggerHandler("remove")}catch(s){}i(t)},e.widget=function(t,n,r){var i,s,o,u,a={},f=t.split(".")[0];t=t.split(".")[1],i=f+"-"+t,r||(r=n,n=e.Widget),e.expr[":"][i.toLowerCase()]=function(t){return!!e.data(t,i)},e[f]=e[f]||{},s=e[f][t],o=e[f][t]=function(e,t){if(!this._createWidget)return new o(e,t);arguments.length&&this._createWidget(e,t)},e.extend(o,s,{version:r.version,_proto:e.extend({},r),_childConstructors:[]}),u=new n,u.options=e.widget.extend({},u.options),e.each(r,function(t,r){if(!e.isFunction(r)){a[t]=r;return}a[t]=function(){var e=function(){return n.prototype[t].apply(this,arguments)},i=function(e){return n.prototype[t].apply(this,e)};return function(){var t=this._super,n=this._superApply,s;return this._super=e,this._superApply=i,s=r.apply(this,arguments),this._super=t,this._superApply=n,s}}()}),o.prototype=e.widget.extend(u,{widgetEventPrefix:s?u.widgetEventPrefix:t},a,{constructor:o,namespace:f,widgetName:t,widgetFullName:i}),s?(e.each(s._childConstructors,function(t,n){var r=n.prototype;e.widget(r.namespace+"."+r.widgetName,o,n._proto)}),delete s._childConstructors):n._childConstructors.push(o),e.widget.bridge(t,o)},e.widget.extend=function(n){var i=r.call(arguments,1),s=0,o=i.length,u,a;for(;s<o;s++)for(u in i[s])a=i[s][u],i[s].hasOwnProperty(u)&&a!==t&&(e.isPlainObject(a)?n[u]=e.isPlainObject(n[u])?e.widget.extend({},n[u],a):e.widget.extend({},a):n[u]=a);return n},e.widget.bridge=function(n,i){var s=i.prototype.widgetFullName||n;e.fn[n]=function(o){var u=typeof o=="string",a=r.call(arguments,1),f=this;return o=!u&&a.length?e.widget.extend.apply(null,[o].concat(a)):o,u?this.each(function(){var r,i=e.data(this,s);if(!i)return e.error("cannot call methods on "+n+" prior to initialization; "+"attempted to call method '"+o+"'");if(!e.isFunction(i[o])||o.charAt(0)==="_")return e.error("no such method '"+o+"' for "+n+" widget instance");r=i[o].apply(i,a);if(r!==i&&r!==t)return f=r&&r.jquery?f.pushStack(r.get()):r,!1}):this.each(function(){var t=e.data(this,s);t?t.option(o||{})._init():e.data(this,s,new i(o,this))}),f}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,r){r=e(r||this.defaultElement||this)[0],this.element=e(r),this.uuid=n++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this.bindings=e(),this.hoverable=e(),this.focusable=e(),r!==this&&(e.data(r,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===r&&this.destroy()}}),this.document=e(r.style?r.ownerDocument:r.document||r),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(n,r){var i=n,s,o,u;if(arguments.length===0)return e.widget.extend({},this.options);if(typeof n=="string"){i={},s=n.split("."),n=s.shift();if(s.length){o=i[n]=e.widget.extend({},this.options[n]);for(u=0;u<s.length-1;u++)o[s[u]]=o[s[u]]||{},o=o[s[u]];n=s.pop();if(r===t)return o[n]===t?null:o[n];o[n]=r}else{if(r===t)return this.options[n]===t?null:this.options[n];i[n]=r}}return this._setOptions(i),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,e==="disabled"&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(t,n,r){var i,s=this;typeof t!="boolean"&&(r=n,n=t,t=!1),r?(n=i=e(n),this.bindings=this.bindings.add(n)):(r=n,n=this.element,i=this.widget()),e.each(r,function(r,o){function u(){if(!t&&(s.options.disabled===!0||e(this).hasClass("ui-state-disabled")))return;return(typeof o=="string"?s[o]:o).apply(s,arguments)}typeof o!="string"&&(u.guid=o.guid=o.guid||u.guid||e.guid++);var a=r.match(/^(\w+)\s*(.*)$/),f=a[1]+s.eventNamespace,l=a[2];l?i.delegate(l,f,u):n.bind(f,u)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function(e,t){function n(){return(typeof e=="string"?r[e]:e).apply(r,arguments)}var r=this;return setTimeout(n,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,n,r){var i,s,o=this.options[t];r=r||{},n=e.Event(n),n.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),n.target=this.element[0],s=n.originalEvent;if(s)for(i in s)i in n||(n[i]=s[i]);return this.element.trigger(n,r),!(e.isFunction(o)&&o.apply(this.element[0],[n].concat(r))===!1||n.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,n){e.Widget.prototype["_"+t]=function(r,i,s){typeof i=="string"&&(i={effect:i});var o,u=i?i===!0||typeof i=="number"?n:i.effect||n:t;i=i||{},typeof i=="number"&&(i={duration:i}),o=!e.isEmptyObject(i),i.complete=s,i.delay&&r.delay(i.delay),o&&e.effects&&e.effects.effect[u]?r[t](i):u!==t&&r[u]?r[u](i.duration,i.easing,s):r.queue(function(n){e(this)[t](),s&&s.call(r[0]),n()})}})}(jQuery),function(e,t){var n=!1;e(document).mouseup(function(){n=!1}),e.widget("ui.mouse",{version:"1.10.1",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(n){if(!0===e.data(n.target,t.widgetName+".preventClickEvent"))return e.removeData(n.target,t.widgetName+".preventClickEvent"),n.stopImmediatePropagation(),!1}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(t){if(n)return;this._mouseStarted&&this._mouseUp(t),this._mouseDownEvent=t;var r=this,i=t.which===1,s=typeof this.options.cancel=="string"&&t.target.nodeName?e(t.target).closest(this.options.cancel).length:!1;if(!i||s||!this._mouseCapture(t))return!0;this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){r.mouseDelayMet=!0},this.options.delay));if(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)){this._mouseStarted=this._mouseStart(t)!==!1;if(!this._mouseStarted)return t.preventDefault(),!0}return!0===e.data(t.target,this.widgetName+".preventClickEvent")&&e.removeData(t.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return r._mouseMove(e)},this._mouseUpDelegate=function(e){return r._mouseUp(e)},e(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),t.preventDefault(),n=!0,!0},_mouseMove:function(t){return e.ui.ie&&(!document.documentMode||document.documentMode<9)&&!t.button?this._mouseUp(t):this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted)},_mouseUp:function(t){return e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery),function(e,t){var n=5;e.widget("ui.slider",e.ui.mouse,{version:"1.10.1",widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget"+" ui-widget-content"+" ui-corner-all"),this._refresh(),this._setOption("disabled",this.options.disabled),this._animateOff=!1},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var t,n,r=this.options,i=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),s="<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>",o=[];n=r.values&&r.values.length||1,i.length>n&&(i.slice(n).remove(),i=i.slice(0,n));for(t=i.length;t<n;t++)o.push(s);this.handles=i.add(e(o.join("")).appendTo(this.element)),this.handle=this.handles.eq(0),this.handles.each(function(t){e(this).data("ui-slider-handle-index",t)})},_createRange:function(){var t=this.options,n="";t.range?(t.range===!0&&(t.values?t.values.length&&t.values.length!==2?t.values=[t.values[0],t.values[0]]:e.isArray(t.values)&&(t.values=t.values.slice(0)):t.values=[this._valueMin(),this._valueMin()]),!this.range||!this.range.length?(this.range=e("<div></div>").appendTo(this.element),n="ui-slider-range ui-widget-header ui-corner-all"):this.range.removeClass("ui-slider-range-min ui-slider-range-max").css({left:"",bottom:""}),this.range.addClass(n+(t.range==="min"||t.range==="max"?" ui-slider-range-"+t.range:""))):this.range=e([])},_setupEvents:function(){var e=this.handles.add(this.range).filter("a");this._off(e),this._on(e,this._handleEvents),this._hoverable(e),this._focusable(e)},_destroy:function(){this.handles.remove(),this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-widget ui-widget-content ui-corner-all"),this._mouseDestroy()},_mouseCapture:function(t){var n,r,i,s,o,u,a,f,l=this,c=this.options;return c.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),n={x:t.pageX,y:t.pageY},r=this._normValueFromMouse(n),i=this._valueMax()-this._valueMin()+1,this.handles.each(function(t){var n=Math.abs(r-l.values(t));if(i>n||i===n&&(t===l._lastChangedValue||l.values(t)===c.min))i=n,s=e(this),o=t}),u=this._start(t,o),u===!1?!1:(this._mouseSliding=!0,this._handleIndex=o,s.addClass("ui-state-active").focus(),a=s.offset(),f=!e(t.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=f?{left:0,top:0}:{left:t.pageX-a.left-s.width()/2,top:t.pageY-a.top-s.height()/2-(parseInt(s.css("borderTopWidth"),10)||0)-(parseInt(s.css("borderBottomWidth"),10)||0)+(parseInt(s.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(t,o,r),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(e){var t={x:e.pageX,y:e.pageY},n=this._normValueFromMouse(t);return this._slide(e,this._handleIndex,n),!1},_mouseStop:function(e){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(e,this._handleIndex),this._change(e,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation=this.options.orientation==="vertical"?"vertical":"horizontal"},_normValueFromMouse:function(e){var t,n,r,i,s;return this.orientation==="horizontal"?(t=this.elementSize.width,n=e.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(t=this.elementSize.height,n=e.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),r=n/t,r>1&&(r=1),r<0&&(r=0),this.orientation==="vertical"&&(r=1-r),i=this._valueMax()-this._valueMin(),s=this._valueMin()+r*i,this._trimAlignValue(s)},_start:function(e,t){var n={handle:this.handles[t],value:this.value()};return this.options.values&&this.options.values.length&&(n.value=this.values(t),n.values=this.values()),this._trigger("start",e,n)},_slide:function(e,t,n){var r,i,s;this.options.values&&this.options.values.length?(r=this.values(t?0:1),this.options.values.length===2&&this.options.range===!0&&(t===0&&n>r||t===1&&n<r)&&(n=r),n!==this.values(t)&&(i=this.values(),i[t]=n,s=this._trigger("slide",e,{handle:this.handles[t],value:n,values:i}),r=this.values(t?0:1),s!==!1&&this.values(t,n,!0))):n!==this.value()&&(s=this._trigger("slide",e,{handle:this.handles[t],value:n}),s!==!1&&this.value(n))},_stop:function(e,t){var n={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(n.value=this.values(t),n.values=this.values()),this._trigger("stop",e,n)},_change:function(e,t){if(!this._keySliding&&!this._mouseSliding){var n={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(n.value=this.values(t),n.values=this.values()),this._lastChangedValue=t,this._trigger("change",e,n)}},value:function(e){if(arguments.length){this.options.value=this._trimAlignValue(e),this._refreshValue(),this._change(null,0);return}return this._value()},values:function(t,n){var r,i,s;if(arguments.length>1){this.options.values[t]=this._trimAlignValue(n),this._refreshValue(),this._change(null,t);return}if(!arguments.length)return this._values();if(!e.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(t):this.value();r=this.options.values,i=arguments[0];for(s=0;s<r.length;s+=1)r[s]=this._trimAlignValue(i[s]),this._change(null,s);this._refreshValue()},_setOption:function(t,n){var r,i=0;t==="range"&&this.options.range===!0&&(n==="min"?(this.options.value=this._values(0),this.options.values=null):n==="max"&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),e.isArray(this.options.values)&&(i=this.options.values.length),e.Widget.prototype._setOption.apply(this,arguments);switch(t){case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue();break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":this._animateOff=!0,this._refreshValue();for(r=0;r<i;r+=1)this._change(null,r);this._animateOff=!1;break;case"min":case"max":this._animateOff=!0,this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_value:function(){var e=this.options.value;return e=this._trimAlignValue(e),e},_values:function(e){var t,n,r;if(arguments.length)return t=this.options.values[e],t=this._trimAlignValue(t),t;if(this.options.values&&this.options.values.length){n=this.options.values.slice();for(r=0;r<n.length;r+=1)n[r]=this._trimAlignValue(n[r]);return n}return[]},_trimAlignValue:function(e){if(e<=this._valueMin())return this._valueMin();if(e>=this._valueMax())return this._valueMax();var t=this.options.step>0?this.options.step:1,n=(e-this._valueMin())%t,r=e-n;return Math.abs(n)*2>=t&&(r+=n>0?t:-t),parseFloat(r.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var t,n,r,i,s,o=this.options.range,u=this.options,a=this,f=this._animateOff?!1:u.animate,l={};this.options.values&&this.options.values.length?this.handles.each(function(r){n=(a.values(r)-a._valueMin())/(a._valueMax()-a._valueMin())*100,l[a.orientation==="horizontal"?"left":"bottom"]=n+"%",e(this).stop(1,1)[f?"animate":"css"](l,u.animate),a.options.range===!0&&(a.orientation==="horizontal"?(r===0&&a.range.stop(1,1)[f?"animate":"css"]({left:n+"%"},u.animate),r===1&&a.range[f?"animate":"css"]({width:n-t+"%"},{queue:!1,duration:u.animate})):(r===0&&a.range.stop(1,1)[f?"animate":"css"]({bottom:n+"%"},u.animate),r===1&&a.range[f?"animate":"css"]({height:n-t+"%"},{queue:!1,duration:u.animate}))),t=n}):(r=this.value(),i=this._valueMin(),s=this._valueMax(),n=s!==i?(r-i)/(s-i)*100:0,l[this.orientation==="horizontal"?"left":"bottom"]=n+"%",this.handle.stop(1,1)[f?"animate":"css"](l,u.animate),o==="min"&&this.orientation==="horizontal"&&this.range.stop(1,1)[f?"animate":"css"]({width:n+"%"},u.animate),o==="max"&&this.orientation==="horizontal"&&this.range[f?"animate":"css"]({width:100-n+"%"},{queue:!1,duration:u.animate}),o==="min"&&this.orientation==="vertical"&&this.range.stop(1,1)[f?"animate":"css"]({height:n+"%"},u.animate),o==="max"&&this.orientation==="vertical"&&this.range[f?"animate":"css"]({height:100-n+"%"},{queue:!1,duration:u.animate}))},_handleEvents:{keydown:function(t){var r,i,s,o,u=e(t.target).data("ui-slider-handle-index");switch(t.keyCode){case e.ui.keyCode.HOME:case e.ui.keyCode.END:case e.ui.keyCode.PAGE_UP:case e.ui.keyCode.PAGE_DOWN:case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:t.preventDefault();if(!this._keySliding){this._keySliding=!0,e(t.target).addClass("ui-state-active"),r=this._start(t,u);if(r===!1)return}}o=this.options.step,this.options.values&&this.options.values.length?i=s=this.values(u):i=s=this.value();switch(t.keyCode){case e.ui.keyCode.HOME:s=this._valueMin();break;case e.ui.keyCode.END:s=this._valueMax();break;case e.ui.keyCode.PAGE_UP:s=this._trimAlignValue(i+(this._valueMax()-this._valueMin())/n);break;case e.ui.keyCode.PAGE_DOWN:s=this._trimAlignValue(i-(this._valueMax()-this._valueMin())/n);break;case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:if(i===this._valueMax())return;s=this._trimAlignValue(i+o);break;case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(i===this._valueMin())return;s=this._trimAlignValue(i-o)}this._slide(t,u,s)},click:function(e){e.preventDefault()},keyup:function(t){var n=e(t.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(t,n),this._change(t,n),e(t.target).removeClass("ui-state-active"))}}})}(jQuery),define("jquery-ui",function(){}),function(e){function i(e,t){if(e.originalEvent.touches.length>1)return;e.preventDefault();var n=e.originalEvent.changedTouches[0],r=document.createEvent("MouseEvents");r.initMouseEvent(t,!0,!0,window,1,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,null),e.target.dispatchEvent(r)}e.support.touch="ontouchend"in document;if(!e.support.touch)return;var t=e.ui.mouse.prototype,n=t._mouseInit,r;t._touchStart=function(e){var t=this;if(r||!t._mouseCapture(e.originalEvent.changedTouches[0]))return;r=!0,t._touchMoved=!1,i(e,"mouseover"),i(e,"mousemove"),i(e,"mousedown")},t._touchMove=function(e){if(!r)return;this._touchMoved=!0,i(e,"mousemove")},t._touchEnd=function(e){if(!r)return;i(e,"mouseup"),i(e,"mouseout"),this._touchMoved||i(e,"click"),r=!1},t._mouseInit=function(){var t=this;t.element.bind("touchstart",e.proxy(t,"_touchStart")).bind("touchmove",e.proxy(t,"_touchMove")).bind("touchend",e.proxy(t,"_touchEnd")),n.call(t)}}(jQuery),define("jquery.ui.touch-punch.min",function(){}),define("libs/krusty5-gui/GUIScrubber",["libs/krusty5-gui/GUIComponentBase","libs/text!libs/krusty5-gui/templates/gui.component.scrubber.template.html","jquery-ui","jquery.ui.touch-punch.min"],function(e,t){function n(n){self=e(n),self.setTemplate(t);var r=null,i=!1,s=0;return self.render=function(){self.getElement().html(self.getTemplate());var e=self.getElement();r=e.find(".slider");var t=e.parent(),n=0;r.slider({min:0,max:1e3,step:1,range:"min"}),_.each(t.children(),function(t){t!=e[0]&&(n+=$(t).width())}),e.width(Math.floor(t.width()-n-parseInt(e.css("border-left-width"))-parseInt(e.css("border-right-width"))-7)),this.getElement().on("touchstart",function(e){e.preventDefault()}),r.on("slidestart",function(e){i=!0,self.getContext().trigger("scrubstart")}),r.on("slidestop",function(e){i=!1,self.getContext().trigger("scrubstop",r.slider("option","value")/10)}),r.on("slide",function(e){i&&r.slider("option","value")!=s&&(s=r.slider("option","value"),self.getContext().trigger("scrub",s/10))})},self.resize=function(){var e=this.getElement(),t=e.parent(),n=0;_.each(t.children(),function(t){t!=e[0]&&(n+=$(t).width())}),e.width(Math.floor(t.width()-n-parseInt(e.css("border-left-width"))-parseInt(e.css("border-right-width"))-7))},self.move=function(e){r.slider("option","value",e*10)},self}return n}),define("libs/text!libs/krusty5-gui/templates/gui.component.quality.template.html",[],function(){return'<div id="quality-1080p" class="button button-size-large button-icon-1080p">&nbsp;</div>\n<div id="quality-720p" class="button button-size-large button-icon-720p">&nbsp;</div>\n<div id="quality-480p" class="button button-size-large button-icon-480p">&nbsp;</div>\n<div id="quality-360p" class="button button-size-large button-icon-360p">&nbsp;</div>\n<div id="quality-180p" class="button button-size-large button-icon-180p">&nbsp;</div>\n'}),define("libs/krusty5-gui/GUIQualitySelector",["libs/krusty5-gui/GUIComponentBase","libs/text!libs/krusty5-gui/templates/gui.component.quality.template.html"],function(e,t){function n(n){return self=e(n),self.setTemplate(t),self.setAvailableQualities=function(e){var t="#quality-selector > .button:not(",n=0;_.each(e,function(e){n!=0&&(t+=", "),t+=".button-icon-"+e,n++}),t+=")",$(t).hide()},self.contextReady=function(){},self}return n}),define("libs/text!libs/krusty5-gui/templates/gui.component.button.template.html",[],function(){return'<div class="button-component-icon">\n	<img />\n</div>'}),define("libs/krusty5-gui/GUIButton",["libs/krusty5-gui/GUIComponentBase","libs/text!libs/krusty5-gui/templates/gui.component.button.template.html"],function(e,t){function n(n){self=e(n),self.setTemplate(t);var r={play:"button-icons/play.png",pause:"button-icons/pause.png",volume:"button-icons/volume.png",mute:"button-icons/mute.png","1080p":"button-icons/1080p.png","720p":"button-icons/720p.png","480p":"button-icons/480p.png","360p":"button-icons/360p.png","180p":"button-icons/180p.png"},i={},s=!1;return self._parseSettings=function(){var e=this.getElement(),t=_.find(e[0].className.split(" "),function(e){return e.indexOf("button-icon")!=-1}),n=_.find(e[0].className.split(" "),function(e){return e.indexOf("button-toggled-icon")!=-1});t!=null&&(i.icon=t.substring(12)),n!=null&&(i.toggledIcon=n.substring(20))},self._renderIcon=function(){var e=this.getElement(),t=e.find(".button-component-icon > img");i.toggledIcon!=null?s?t[0].src=self.getImgLocation()+r[i.toggledIcon]:t[0].src=self.getImgLocation()+r[i.icon]:t[0].src=self.getImgLocation()+r[i.icon],t[0].width=e.width(),t[0].height=e.height()},self._touchStart=function(e,t){this.trigger("mousedown",t)},self._touchEnd=function(e,t){this.trigger("mouseup",t)},self._mouseDown=function(e,t){this.getElement().find(".button").addClass("button-mousedown")},self._mouseUp=function(e,t){this.getElement().find("button").removeClass("button-mousedown")},self._click=function(e,t){this.getContext().trigger("click",this)},self._listenToTouchEvents=function(){var e=this;this.on("touchstart",function(t){e._touchStart(e,t)}),this.on("touchend",function(t){e._touchEnd(e,t)})},self._listenToElementEvents=function(){var e=this;this.on("mousedown",function(t){e._mouseDown(e,t)}),this.on("mouseup",function(t){e._mouseUp(e,t)}),this.on("click",function(t){e._click(e,t)})},self.setToggled=function(e){s=e,this._renderIcon()},self.toggle=function(){return s=!s,this._renderIcon(),s},self.render=function(){this.getElement().html(t),this._parseSettings(),this._renderIcon()},self.isToggled=function(){return s},self.resize=function(){this._renderIcon()},self._listenToElementEvents(),self}return n}),define("libs/util/Time",[],function(){var e={};return e.parseTime=function(e,t){var n=Math.floor(e/3600),r=Math.floor((e-n*3600)/60),i=Math.floor(e-n*3600-r*60);n<10&&(n="0"+n),r<10&&(r="0"+r),i<10&&(i="0"+i);if(t!=null){var s=t.replace("hh",n);return s=s.replace("h",n*1+""),s=s.replace("mm",r),s=s.replace("m",r*1+""),s=s.replace("ss",i),s=s.replace("s",i*1+""),s}return n+":"+r+":"+i},e}),define("libs/text!libs/krusty5-gui/templates/gui.component.timer.template.html",[],function(){return'<span id="timer_tmpl">\n	<%=currentTime%> / <%=duration%>\n</span>'}),define("libs/krusty5-gui/GUITimer",["libs/krusty5-gui/GUIComponentBase","libs/util/Time","libs/text!libs/krusty5-gui/templates/gui.component.timer.template.html"],function(e,t,n){function r(r){return self=e(r),self.setTemplate(n),self.setTemplateContents({duration:"0:00:00",currentTime:"0:00:00"}),self.setDuration=function(e){this.setTmplValue("duration",t.parseTime(e,"h:mm:ss")),this.render()},self.setCurrentTime=function(e){this.setTmplValue("currentTime",t.parseTime(e,"h:mm:ss")),this.render()},this.getElement().on("touchstart",function(e){e.preventDefault()}),$("#timer_tmpl").on("touchstart",function(e){e.preventDefault()}),self}return r}),define("libs/text!libs/krusty5-gui/templates/gui.component.volume.template.html",[],function(){return'<div class="volume-slider">\n	\n</div>'}),define("libs/krusty5-gui/GUIVolumeController",["libs/krusty5-gui/GUIComponentBase","libs/text!libs/krusty5-gui/templates/gui.component.volume.template.html"],function(e,t){function n(n){self=e(n),self.setTemplate(t);var r=null,i=!1,s=null;return self.render=function(){var e=self.getElement();e.html(self.getTemplate()),r=e.find(".volume-slider"),r.slider({min:0,max:100,range:"min",orientation:"vertical"}),e.on("mouseover",function(){i=!0,clearTimeout(s)}),e.on("mouseleave",function(){i=!1,s=setTimeout(function(){e.hide()},1e3)}),e.hide();var t=this;r.on("slide",function(e,n){t.getContext().trigger("volumechange",t)})},self.hasFocus=function(){return i},self.setValue=function(e){r.slider("option","value",e*100)},self.getValue=function(){return r.slider("option","value")},self}return n}),define("libs/text!libs/krusty5-gui/templates/gui.component.screenshot-mask.template.html",[],function(){return'<div class="screenshot"></div>'}),define("libs/krusty5-gui/GUIScreenshotMask",["libs/krusty5-gui/GUIScalableMaskComponent","libs/text!libs/krusty5-gui/templates/gui.component.screenshot-mask.template.html"],function(e,t){function n(n){var r=e(n);return r.setTemplate(t),r.contextReady=function(){this.setDisplayArea(this.getChildren(".screenshot")[0]),this.setGivenRatio("4:3")},r}return n}),define("libs/krusty5-gui/ComponentMappings",["libs/krusty5-gui/GUIPresentation","libs/krusty5-gui/GUIViewport","libs/krusty5-gui/GUIControls","libs/krusty5-gui/GUIScreenshot","libs/krusty5-gui/GUIPlayback","libs/krusty5-gui/GUIDialog","libs/krusty5-gui/GUIScrubber","libs/krusty5-gui/GUIQualitySelector","libs/krusty5-gui/GUIButton","libs/krusty5-gui/GUITimer","libs/krusty5-gui/GUIVolumeController","libs/krusty5-gui/GUIScreenshotMask"],function(e,t,n,r,i,s,o,u,a,f,l,c){var h={".presentation":e,".viewport":t,".controls":n,".screenshot":r,".playback":i,".dialog":s,".scrubber":o,".quality-selector":u,".button":a,".timer":f,".volume-control":l,".screenshot-mask":c};return h}),define("libs/krusty5-gui/GUIComponentContext",["libs/krusty5-gui/ComponentMappings"],function(e){function t(t){var n=this;_.extend(n,Backbone.Events);var r={imgLocation:""};return $.extend(r,t),n.instances=[],n.createAll=function(t,r,i){t.jquery||(t=$(t)),i==null&&(i=0),n.create(t,r);var s=n.get("."+t[0].className)[0];if(!_.isEmpty(s)){var o=[];$.each(e,function(e,t){_.each(s.getElement().find(e),function(e){o.push(e)})}),_.each(o,function(e){n.createAll(e,s,i+1)})}i==0&&_.each(n.instances,function(e){e.contextReady(),n.trigger("contextready")})},n.create=function(t,i){t.jquery||(t=$(t));var s={};$.each(e,function(n,i){t.is(n)&&(s=e[n]({element:t,imgLocation:r.imgLocation}))}),s.setContext(n),s.render(),s.setParent(i),i!=null&&i.addChild(s),n.instances.push(s)},n.get=function(e){return $(_.filter(n.instances,function(t){return t.getElement().is(e)}))},n.resize=function(){_.each(n.instances,function(e){typeof e.resize=="function"&&e.resize()})},n.controls=function(e){e},n}return t}),define("libs/krusty5-gui/GUIController",["libs/krusty5-gui/GUIComponentContext"],function(e){function t(t){function i(){r.componentContext=new e({imgLocation:r.html5player.get("imgLocation")}),r.componentContext.createAll(r.html5player.get("targetElement")),r.componentContext.get(".presentation")[0].setDimensions({width:$(window).width(),height:$(window).height()}),r.componentContext.resize(),$(window).resize(function(){_()}),s()}function s(){r.componentContext.on("click",M),r.componentContext.on("scrub",S),r.componentContext.on("scrubstart",E),r.componentContext.on("scrubstop",x),r.componentContext.on("volumechange",c)}function o(){r.html5player.on("initialize",u),r.html5player.on("error",f),r.html5player.on("qualitychanged",l),r.html5player.on("volumechanged",h),r.html5player.on("screenshotchanged",p),r.html5player.on("elementchanged",d),r.html5player.on("durationknown",v),r.html5player.on("readytoplay",m),r.html5player.on("timeupdate",g),r.html5player.on("percentageupdate",y),r.html5player.on("availablequalitieschanged",b),r.html5player.on("paused",N),r.html5player.on("play",T),r.html5player.on("seeking",C),r.html5player.on("loading",a),r.html5player.on("playlistended",k),r.html5player.on("changingquality",L),r.html5player.on("donechangingquality",w),r.html5player.on("aspectratiochanged",A),r.html5player.on("nativecontrolschanged",O)}function u(){i(),r.componentContext.get(".dialog")[0].setIndicator("loading"),r.componentContext.get(".dialog")[0].setMessage("Loading the presentation!"),r.componentContext.get(".controls")[0].setQuality(r.html5player.get("defaultQuality"))}function a(e){r.componentContext.get(".dialog")[0].setIndicator("loading"),r.componentContext.get(".dialog")[0].setMessage(e)}function f(e){r.componentContext.get(".dialog")[0].setIndicator("error"),r.componentContext.get(".dialog")[0].setMessage(e)}function l(e){r.componentContext.get(".controls")[0].setQuality(e)}function c(e){r.html5player.volume(e.getValue()/100)}function h(e){e!=r.componentContext.get(".volume-control")[0].getValue(),r.componentContext.get(".volume-control")[0].setValue(e)}function p(e){r.componentContext.get(".screenshot")[0].setScreenshot(e)}function d(){r.componentContext.get(".playback")[0].setVideoElement(r.html5player.element())}function v(e){r.componentContext.get(".timer")[0].setDuration(e),r.componentContext.get(".screenshot")[0].show()}function m(){r.componentContext.get(".dialog")[0].setIndicator("play"),r.componentContext.get(".dialog")[0].setMessage("Click to play!")}function g(e){r.componentContext.get(".timer")[0].setCurrentTime(e)}function y(e){r.componentContext.get(".scrubber")[0].move(e)}function b(e){r.componentContext.get(".quality-selector")[0].setAvailableQualities(e)}function w(){r.componentContext.get(".dialog")[0].setIndicator("play"),r.componentContext.get(".dialog")[0].setMessage("Click to play!")}function E(){r.componentContext.get(".playback")[0].hide(),r.componentContext.get(".screenshot")[0].show(),r.html5player.scrubStart()}function S(e){r.html5player.scrub(e)}function x(e){r.componentContext.get(".screenshot")[0].hide(),r.html5player.scrubStop(e)}function T(){r.componentContext.get("#play-button")[0].setToggled(!0),r.componentContext.get(".playback")[0].show(),r.componentContext.get(".dialog")[0].hide(),r.componentContext.get(".screenshot")[0].hide()}function N(){r.componentContext.get("#play-button")[0].setToggled(!1),r.componentContext.get(".dialog")[0].show()}function C(){r.componentContext.get(".dialog")[0].setIndicator("loading"),r.componentContext.get(".dialog")[0].setMessage("Seeking")}function k(){r.componentContext.get(".dialog")[0].setIndicator("play"),r.componentContext.get(".dialog")[0].setMessage("Play again!")}function L(){r.componentContext.get(".dialog")[0].setIndicator("loading"),r.componentContext.get(".dialog")[0].setMessage("Changing quality"),r.componentContext.get(".dialog")[0].show()}function A(e){r.componentContext.get(".viewport")[0].setWantedRatio(e),r.componentContext.get(".viewport")[0].resize(),r.componentContext.get(".screenshot-mask")[0].setWantedRatio(e),r.componentContext.get(".screenshot-mask")[0].resize()}function O(){r.html5player.get("nativeControls")?r.componentContext.get(".controls")[0].hide():r.componentContext.get(".controls")[0].show()}function M(e){switch(e.getElement().attr("id")){case"play-button":e.isToggled()?r.html5player.pause():r.html5player.play();break;case"volume-button":e.isToggled()?r.html5player.unmute():r.html5player.mute();break;case"dialog":e.getState()=="play"&&r.html5player.play();break;case"quality-1080p":r.html5player.quality("1080p");break;case"quality-720p":r.html5player.quality("720p");break;case"quality-480p":r.html5player.quality("480p");break;case"quality-360p":r.html5player.quality("360p");break;case"quality-180p":r.html5player.quality("180p")}}function _(){r.componentContext.get(".presentation")[0].setDimensions({width:$(window).width(),height:$(window).height()}),r.componentContext.resize()}var n=this,r={html5player:null,componentContext:null};return $.extend(r,t),n.setPlayer=function(e){r.html5player=e,o()},n.getDimensions=function(){var e=r.componentContext.get(".viewport")[0].getElement();return{left:parseFloat(e.css("left")),top:parseFloat(e.css("top")),width:parseFloat(e.width()),height:parseFloat(e.height())}},n}return t}),function(e,t){typeof exports!="undefined"?t(e,exports,require("underscore")):typeof define=="function"&&define.amd?define("backbone",["underscore","exports"],function(n,r){e.Backbone=t(e,r,n,$)}):e.Backbone=t(e,{},e._,e.jQuery||e.Zepto||e.ender)}(this,function(e,t,n,r){var i=e.Backbone,s=[],o=s.push,u=s.slice,a=s.splice;t.VERSION="0.9.10",t.$=r,t.noConflict=function(){return e.Backbone=i,this},t.emulateHTTP=!1,t.emulateJSON=!1;var f=/\s+/,l=function(e,t,n,r){if(!n)return!0;if(typeof n=="object")for(var i in n)e[t].apply(e,[i,n[i]].concat(r));else{if(!f.test(n))return!0;var s=n.split(f);for(var o=0,u=s.length;o<u;o++)e[t].apply(e,[s[o]].concat(r))}},c=function(e,t){var n,r=-1,i=e.length;switch(t.length){case 0:while(++r<i)(n=e[r]).callback.call(n.ctx);return;case 1:while(++r<i)(n=e[r]).callback.call(n.ctx,t[0]);return;case 2:while(++r<i)(n=e[r]).callback.call(n.ctx,t[0],t[1]);return;case 3:while(++r<i)(n=e[r]).callback.call(n.ctx,t[0],t[1],t[2]);return;default:while(++r<i)(n=e[r]).callback.apply(n.ctx,t)}},h=t.Events={on:function(e,t,n){if(!l(this,"on",e,[t,n])||!t)return this;this._events||(this._events={});var r=this._events[e]||(this._events[e]=[]);return r.push({callback:t,context:n,ctx:n||this}),this},once:function(e,t,r){if(!l(this,"once",e,[t,r])||!t)return this;var i=this,s=n.once(function(){i.off(e,s),t.apply(this,arguments)});return s._callback=t,this.on(e,s,r),this},off:function(e,t,r){var i,s,o,u,a,f,c,h;if(!this._events||!l(this,"off",e,[t,r]))return this;if(!e&&!t&&!r)return this._events={},this;u=e?[e]:n.keys(this._events);for(a=0,f=u.length;a<f;a++){e=u[a];if(i=this._events[e]){o=[];if(t||r)for(c=0,h=i.length;c<h;c++)s=i[c],(t&&t!==s.callback&&t!==s.callback._callback||r&&r!==s.context)&&o.push(s);this._events[e]=o}}return this},trigger:function(e){if(!this._events)return this;var t=u.call(arguments,1);if(!l(this,"trigger",e,t))return this;var n=this._events[e],r=this._events.all;return n&&c(n,t),r&&c(r,arguments),this},listenTo:function(e,t,r){var i=this._listeners||(this._listeners={}),s=e._listenerId||(e._listenerId=n.uniqueId("l"));return i[s]=e,e.on(t,typeof t=="object"?this:r,this),this},stopListening:function(e,t,n){var r=this._listeners;if(!r)return;if(e)e.off(t,typeof t=="object"?this:n,this),!t&&!n&&delete r[e._listenerId];else{typeof t=="object"&&(n=this);for(var i in r)r[i].off(t,n,this);this._listeners={}}return this}};h.bind=h.on,h.unbind=h.off,n.extend(t,h);var p=t.Model=function(e,t){var r,i=e||{};this.cid=n.uniqueId("c"),this.attributes={},t&&t.collection&&(this.collection=t.collection),t&&t.parse&&(i=this.parse(i,t)||{});if(r=n.result(this,"defaults"))i=n.defaults({},i,r);this.set(i,t),this.changed={},this.initialize.apply(this,arguments)};n.extend(p.prototype,h,{changed:null,idAttribute:"id",initialize:function(){},toJSON:function(e){return n.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return n.escape(this.get(e))},has:function(e){return this.get(e)!=null},set:function(e,t,r){var i,s,o,u,a,f,l,c;if(e==null)return this;typeof e=="object"?(s=e,r=t):(s={})[e]=t,r||(r={});if(!this._validate(s,r))return!1;o=r.unset,a=r.silent,u=[],f=this._changing,this._changing=!0,f||(this._previousAttributes=n.clone(this.attributes),this.changed={}),c=this.attributes,l=this._previousAttributes,this.idAttribute in s&&(this.id=s[this.idAttribute]);for(i in s)t=s[i],n.isEqual(c[i],t)||u.push(i),n.isEqual(l[i],t)?delete this.changed[i]:this.changed[i]=t,o?delete c[i]:c[i]=t;if(!a){u.length&&(this._pending=!0);for(var h=0,p=u.length;h<p;h++)this.trigger("change:"+u[h],this,c[u[h]],r)}if(f)return this;if(!a)while(this._pending)this._pending=!1,this.trigger("change",this,r);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,n.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var r in this.attributes)t[r]=void 0;return this.set(t,n.extend({},e,{unset:!0}))},hasChanged:function(e){return e==null?!n.isEmpty(this.changed):n.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?n.clone(this.changed):!1;var t,r=!1,i=this._changing?this._previousAttributes:this.attributes;for(var s in e){if(n.isEqual(i[s],t=e[s]))continue;(r||(r={}))[s]=t}return r},previous:function(e){return e==null||!this._previousAttributes?null:this._previousAttributes[e]},previousAttributes:function(){return n.clone(this._previousAttributes)},fetch:function(e){e=e?n.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=e.success;return e.success=function(e,n,r){if(!e.set(e.parse(n,r),r))return!1;t&&t(e,n,r)},this.sync("read",this,e)},save:function(e,t,r){var i,s,o,u,a=this.attributes;return e==null||typeof e=="object"?(i=e,r=t):(i={})[e]=t,i&&(!r||!r.wait)&&!this.set(i,r)?!1:(r=n.extend({validate:!0},r),this._validate(i,r)?(i&&r.wait&&(this.attributes=n.extend({},a,i)),r.parse===void 0&&(r.parse=!0),s=r.success,r.success=function(e,t,r){e.attributes=a;var o=e.parse(t,r);r.wait&&(o=n.extend(i||{},o));if(n.isObject(o)&&!e.set(o,r))return!1;s&&s(e,t,r)},o=this.isNew()?"create":r.patch?"patch":"update",o==="patch"&&(r.attrs=i),u=this.sync(o,this,r),i&&r.wait&&(this.attributes=a),u):!1)},destroy:function(e){e=e?n.clone(e):{};var t=this,r=e.success,i=function(){t.trigger("destroy",t,t.collection,e)};e.success=function(e,t,n){(n.wait||e.isNew())&&i(),r&&r(e,t,n)};if(this.isNew())return e.success(this,null,e),!1;var s=this.sync("delete",this,e);return e.wait||i(),s},url:function(){var e=n.result(this,"urlRoot")||n.result(this.collection,"url")||_();return this.isNew()?e:e+(e.charAt(e.length-1)==="/"?"":"/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},isValid:function(e){return!this.validate||!this.validate(this.attributes,e)},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=n.extend({},this.attributes,e);var r=this.validationError=this.validate(e,t)||null;return r?(this.trigger("invalid",this,r,t||{}),!1):!0}});var d=t.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),t.comparator!==void 0&&(this.comparator=t.comparator),this.models=[],this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,n.extend({silent:!0},t))};n.extend(d.prototype,h,{model:p,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return t.sync.apply(this,arguments)},add:function(e,t){e=n.isArray(e)?e.slice():[e],t||(t={});var r,i,s,u,f,l,c,h,p,d;c=[],h=t.at,p=this.comparator&&h==null&&t.sort!=0,d=n.isString(this.comparator)?this.comparator:null;for(r=0,i=e.length;r<i;r++){if(!(s=this._prepareModel(u=e[r],t))){this.trigger("invalid",this,u,t);continue}if(f=this.get(s)){t.merge&&(f.set(u===s?s.attributes:u,t),p&&!l&&f.hasChanged(d)&&(l=!0));continue}c.push(s),s.on("all",this._onModelEvent,this),this._byId[s.cid]=s,s.id!=null&&(this._byId[s.id]=s)}c.length&&(p&&(l=!0),this.length+=c.length,h!=null?a.apply(this.models,[h,0].concat(c)):o.apply(this.models,c)),l&&this.sort({silent:!0});if(t.silent)return this;for(r=0,i=c.length;r<i;r++)(s=c[r]).trigger("add",s,this,t);return l&&this.trigger("sort",this,t),this},remove:function(e,t){e=n.isArray(e)?e.slice():[e],t||(t={});var r,i,s,o;for(r=0,i=e.length;r<i;r++){o=this.get(e[r]);if(!o)continue;delete this._byId[o.id],delete this._byId[o.cid],s=this.indexOf(o),this.models.splice(s,1),this.length--,t.silent||(t.index=s,o.trigger("remove",o,this,t)),this._removeReference(o)}return this},push:function(e,t){return e=this._prepareModel(e,t),this.add(e,n.extend({at:this.length},t)),e},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return e=this._prepareModel(e,t),this.add(e,n.extend({at:0},t)),e},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(e,t){return this.models.slice(e,t)},get:function(e){return e==null?void 0:(this._idAttr||(this._idAttr=this.model.prototype.idAttribute),this._byId[e.id||e.cid||e[this._idAttr]||e])},at:function(e){return this.models[e]},where:function(e){return n.isEmpty(e)?[]:this.filter(function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return e||(e={}),n.isString(this.comparator)||this.comparator.length===1?this.models=this.sortBy(this.comparator,this):this.models.sort(n.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return n.invoke(this.models,"get",e)},update:function(e,t){t=n.extend({add:!0,merge:!0,remove:!0},t),t.parse&&(e=this.parse(e,t));var r,i,s,o,u=[],a=[],f={};n.isArray(e)||(e=e?[e]:[]);if(t.add&&!t.remove)return this.add(e,t);for(i=0,s=e.length;i<s;i++)r=e[i],o=this.get(r),t.remove&&o&&(f[o.cid]=!0),(t.add&&!o||t.merge&&o)&&u.push(r);if(t.remove)for(i=0,s=this.models.length;i<s;i++)r=this.models[i],f[r.cid]||a.push(r);return a.length&&this.remove(a,t),u.length&&this.add(u,t),this},reset:function(e,t){t||(t={}),t.parse&&(e=this.parse(e,t));for(var r=0,i=this.models.length;r<i;r++)this._removeReference(this.models[r]);return t.previousModels=this.models.slice(),this._reset(),e&&this.add(e,n.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),this},fetch:function(e){e=e?n.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=e.success;return e.success=function(e,n,r){var i=r.update?"update":"reset";e[i](n,r),t&&t(e,n,r)},this.sync("read",this,e)},create:function(e,t){t=t?n.clone(t):{};if(!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var r=this,i=t.success;return t.success=function(e,t,n){n.wait&&r.add(e,n),i&&i(e,t,n)},e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models.length=0,this._byId={}},_prepareModel:function(e,t){if(e instanceof p)return e.collection||(e.collection=this),e;t||(t={}),t.collection=this;var n=new this.model(e,t);return n._validate(e,t)?n:!1},_removeReference:function(e){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){if((e==="add"||e==="remove")&&n!==this)return;e==="destroy"&&this.remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],t.id!=null&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments)},sortedIndex:function(e,t,r){t||(t=this.comparator);var i=n.isFunction(t)?t:function(e){return e.get(t)};return n.sortedIndex(this.models,e,i,r)}});var v=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];n.each(v,function(e){d.prototype[e]=function(){var t=u.call(arguments);return t.unshift(this.models),n[e].apply(n,t)}});var m=["groupBy","countBy","sortBy"];n.each(m,function(e){d.prototype[e]=function(t,r){var i=n.isFunction(t)?t:function(e){return e.get(t)};return n[e](this.models,i,r)}});var g=t.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},y=/\((.*?)\)/g,b=/(\(\?)?:\w+/g,w=/\*\w+/g,E=/[\-{}\[\]+?.,\\\^$|#\s]/g;n.extend(g.prototype,h,{initialize:function(){},route:function(e,r,i){return n.isRegExp(e)||(e=this._routeToRegExp(e)),i||(i=this[r]),t.history.route(e,n.bind(function(n){var s=this._extractParameters(e,n);i&&i.apply(this,s),this.trigger.apply(this,["route:"+r].concat(s)),this.trigger("route",r,s),t.history.trigger("route",this,r,s)},this)),this},navigate:function(e,n){return t.history.navigate(e,n),this},_bindRoutes:function(){if(!this.routes)return;var e,t=n.keys(this.routes);while((e=t.pop())!=null)this.route(e,this.routes[e])},_routeToRegExp:function(e){return e=e.replace(E,"\\$&").replace(y,"(?:$1)?").replace(b,function(e,t){return t?e:"([^/]+)"}).replace(w,"(.*?)"),new RegExp("^"+e+"$")},_extractParameters:function(e,t){return e.exec(t).slice(1)}});var S=t.History=function(){this.handlers=[],n.bindAll(this,"checkUrl"),typeof window!="undefined"&&(this.location=window.location,this.history=window.history)},x=/^[#\/]|\s+$/g,T=/^\/+|\/+$/g,N=/msie [\w.]+/,C=/\/$/;S.started=!1,n.extend(S.prototype,h,{interval:50,getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(e==null)if(this._hasPushState||!this._wantsHashChange||t){e=this.location.pathname;var n=this.root.replace(C,"");e.indexOf(n)||(e=e.substr(n.length))}else e=this.getHash();return e.replace(x,"")},start:function(e){if(S.started)throw new Error("Backbone.history has already been started");S.started=!0,this.options=n.extend({},{root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var r=this.getFragment(),i=document.documentMode,s=N.exec(navigator.userAgent.toLowerCase())&&(!i||i<=7);this.root=("/"+this.root+"/").replace(T,"/"),s&&this._wantsHashChange&&(this.iframe=t.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(r)),this._hasPushState?t.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!s?t.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=r;var o=this.location,u=o.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!u)return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&u&&o.hash&&(this.fragment=this.getHash().replace(x,""),this.history.replaceState({},document.title,this.root+this.fragment+o.search));if(!this.options.silent)return this.loadUrl()},stop:function(){t.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),S.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe)));if(t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(e){var t=this.fragment=this.getFragment(e),r=n.any(this.handlers,function(e){if(e.route.test(t))return e.callback(t),!0});return r},navigate:function(e,t){if(!S.started)return!1;if(!t||t===!0)t={trigger:t};e=this.getFragment(e||"");if(this.fragment===e)return;this.fragment=e;var n=this.root+e;if(this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}t.trigger&&this.loadUrl(e)},_updateHash:function(e,t,n){if(n){var r=e.href.replace(/(javascript:|#).*$/,"");e.replace(r+"#"+t)}else e.hash="#"+t}}),t.history=new S;var k=t.View=function(e){this.cid=n.uniqueId("view"),this._configure(e||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},L=/^(\S+)\s*(.*)$/,A=["model","collection","el","id","attributes","className","tagName","events"];n.extend(k.prototype,h,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,n){return this.$el&&this.undelegateEvents(),this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0],n!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=n.result(this,"events")))return;this.undelegateEvents();for(var t in e){var r=e[t];n.isFunction(r)||(r=this[e[t]]);if(!r)throw new Error('Method "'+e[t]+'" does not exist');var i=t.match(L),s=i[1],o=i[2];r=n.bind(r,this),s+=".delegateEvents"+this.cid,o===""?this.$el.on(s,r):this.$el.on(s,o,r)}},undelegateEvents:function(){this.$el.off(".delegateEvents"+this.cid)},_configure:function(e){this.options&&(e=n.extend({},n.result(this,"options"),e)),n.extend(this,n.pick(e,A)),this.options=e},_ensureElement:function(){if(!this.el){var e=n.extend({},n.result(this,"attributes"));this.id&&(e.id=n.result(this,"id")),this.className&&(e["class"]=n.result(this,"className"));var r=t.$("<"+n.result(this,"tagName")+">").attr(e);this.setElement(r,!1)}else this.setElement(n.result(this,"el"),!1)}});var O={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};t.sync=function(e,r,i){var s=O[e];n.defaults(i||(i={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var o={type:s,dataType:"json"};i.url||(o.url=n.result(r,"url")||_()),i.data==null&&r&&(e==="create"||e==="update"||e==="patch")&&(o.contentType="application/json",o.data=JSON.stringify(i.attrs||r.toJSON(i))),i.emulateJSON&&(o.contentType="application/x-www-form-urlencoded",o.data=o.data?{model:o.data}:{});if(i.emulateHTTP&&(s==="PUT"||s==="DELETE"||s==="PATCH")){o.type="POST",i.emulateJSON&&(o.data._method=s);var u=i.beforeSend;i.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",s);if(u)return u.apply(this,arguments)}}o.type!=="GET"&&!i.emulateJSON&&(o.processData=!1);var a=i.success;i.success=function(e){a&&a(r,e,i),r.trigger("sync",r,e,i)};var f=i.error;i.error=function(e){f&&f(r,e,i),r.trigger("error",r,e,i)};var l=i.xhr=t.ajax(n.extend(o,i));return r.trigger("request",r,l,i),l},t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var M=function(e,t){var r=this,i;e&&n.has(e,"constructor")?i=e.constructor:i=function(){return r.apply(this,arguments)},n.extend(i,r,t);var s=function(){this.constructor=i};return s.prototype=r.prototype,i.prototype=new s,e&&n.extend(i.prototype,e),i.__super__=r.prototype,i};p.extend=d.extend=g.extend=k.extend=S.extend=M;var _=function(){throw new Error('A "url" property or function must be specified')};return t}),define("libs/util/EventListener",["underscore"],function(e){var t={_passThrough:function(e,t){typeof this.log=="function"&&this.log("passThrough",3,"Passing through event: "+e),this.trigger(e,t)},_applyCallbacks:function(t,n){typeof this.log=="function"&&this.log("_applyCallbacks( "+t+")",1);if(typeof t.on!="function")throw"Object is no jQuery object";e.each(n,function(n,r){if(!e.isArray(n))throw"Callback functions are not defined as array!";n.length==0?t.on(r,function(e){this._passThrough(r,e)},this):e.each(n,function(e){t.on(r,this[e])},this)},this)},_removeCallbacks:function(t,n){typeof this.log=="function"&&this.log("_removeCallbacks( "+t+")",1);if(typeof t.off!="function")throw"Object is no jQuery object";e.each(n,function(n,r){if(!e.isArray(n))throw"Callback functions are not defined as array!";n.length==0?t.off(r):e.each(n,function(e){t.off(r,this[e])},this)},this)}};return t}),window.Modernizr=function(e,t,n){function r(e){p.cssText=e}function i(e,t){return r(m.join(e+";")+(t||""))}function s(e,t){return typeof e===t}function o(e,t){return!!~(""+e).indexOf(t)}function u(e,t,r){for(var i in e){var o=t[e[i]];if(o!==n)return r===!1?e[i]:s(o,"function")?o.bind(r||t):o}return!1}var a="2.6.2",f={},l=t.documentElement,c="modernizr",h=t.createElement(c),p=h.style,d,v={}.toString,m=" -webkit- -moz- -o- -ms- ".split(" "),g={},y={},b={},w=[],E=w.slice,S,x=function(e,n,r,i){var s,o,u,a,f=t.createElement("div"),h=t.body,p=h||t.createElement("body");if(parseInt(r,10))while(r--)u=t.createElement("div"),u.id=i?i[r]:c+(r+1),f.appendChild(u);return s=["&#173;",'<style id="s',c,'">',e,"</style>"].join(""),f.id=c,(h?f:p).innerHTML+=s,p.appendChild(f),h||(p.style.background="",p.style.overflow="hidden",a=l.style.overflow,l.style.overflow="hidden",l.appendChild(p)),o=n(f,e),h?f.parentNode.removeChild(f):(p.parentNode.removeChild(p),l.style.overflow=a),!!o},T={}.hasOwnProperty,N;!s(T,"undefined")&&!s(T.call,"undefined")?N=function(e,t){return T.call(e,t)}:N=function(e,t){return t in e&&s(e.constructor.prototype[t],"undefined")},Function.prototype.bind||(Function.prototype.bind=function(e){var t=this;if(typeof t!="function")throw new TypeError;var n=E.call(arguments,1),r=function(){if(this instanceof r){var i=function(){};i.prototype=t.prototype;var s=new i,o=t.apply(s,n.concat(E.call(arguments)));return Object(o)===o?o:s}return t.apply(e,n.concat(E.call(arguments)))};return r}),g.touch=function(){var n;return"ontouchstart"in e||e.DocumentTouch&&t instanceof DocumentTouch?n=!0:x(["@media (",m.join("touch-enabled),("),c,")","{#modernizr{top:9px;position:absolute}}"].join(""),function(e){n=e.offsetTop===9}),n},g.video=function(){var e=t.createElement("video"),n=!1;try{if(n=!!e.canPlayType)n=new Boolean(n),n.ogg=e.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,""),n.h264=e.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,""),n.webm=e.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,"")}catch(r){}return n};for(var C in g)N(g,C)&&(S=C.toLowerCase(),f[S]=g[C](),w.push((f[S]?"":"no-")+S));return f.addTest=function(e,t){if(typeof e=="object")for(var r in e)N(e,r)&&f.addTest(r,e[r]);else{e=e.toLowerCase();if(f[e]!==n)return f;t=typeof t=="function"?t():t,typeof enableClasses!="undefined"&&enableClasses&&(l.className+=" "+(t?"":"no-")+e),f[e]=t}return f},r(""),h=d=null,f._version=a,f._prefixes=m,f.testStyles=x,f}(this,this.document),define("modernizr",function(){}),define("libs/krusty5-core/videoelement/VideoElement",["underscore","backbone","libs/util/EventListener","libs/util/Logger","modernizr"],function(e,t,n,r){var i=t.Model.extend(r).extend(n).extend({logObjectName:"VideoElement",defaults:{HTMLElement:null,duration:0,preloaded:!1,playing:!1},_callbacks:{HTMLElement:{loadstart:["_loadStart"],emptied:["_emptied"],buffered:["_buffered"],canplaythrough:["_canPlayThrough"],ended:["_ended"],ratechange:["_rateChange"],progress:["_progress"],stalled:["_stalled"],playing:["_playing"],durationchange:["_durationChange"],volumechange:["_volumeChange"],suspend:["_suspend"],loadedmetadata:["_loadedMetaData"],waiting:["_waiting"],timeupdate:["_timeUpdate"],abort:["_abort"],loadeddata:["_loadedData"],seeking:["_seeking"],play:["_play"],error:["_error"],canplay:["_canPlay"],seeked:["_seeked"],pause:["_pause"]}},initialize:function(){this.log("initialize()",1),e.bindAll(this),this._createHTMLElement(),this._parseDuration()},play:function(){this.log("play()",1),this.get("HTMLElement")[0].play()},pause:function(){this.log("pause()",1),this.get("HTMLElement")[0].pause()},currentTime:function(e){if(e==null)return this.log("currentTime()",2),this.get("HTMLElement")[0].currentTime;this.log("currentTime( "+e+" )",1),this.set("wantedPosition",e);if(this.get("HTMLElement")[0].readyState>0)this.log("currentTime()",1,"Video readystate is capable of changing time, changing time to: "+e),this.get("HTMLElement")[0].currentTime=e;else{this.log("currentTime()",1,"Video readystate is not yet capable of changing time, wait for enough data to load before changing time.");var t=this;this.get("HTMLElement").on("loadedmetadata",function(){t.log("currentTime",1,"Metadata loaded, change time to: "+t.get("wantedPosition")),t.get("HTMLElement")[0].currentTime=t.get("wantedPosition")})}},volume:function(e){return e!=undefined&&(this.log("volume( "+e+" )",1),this.get("HTMLElement")[0].volume=e),this.log("volume()",1),this.get("HTMLElement")[0].volume},loadMetaData:function(){this.log("loadMetaData()",1),this.get("HTMLElement").attr("preload","metadata")},preload:function(){this.log("preload()",1);if(!this.get("preloaded")){this.log("preload()",2,"Item not yet preloaded. Play a bit to start loading on IOS devices, when play has started, pause it immediatly.");if(Modernizr.touch){var e=this;e.get("HTMLElement").on("loadstart",function(){e.trigger("canplaythrough")})}this.set("preloaded",!0),$(this.get("HTMLElement")).attr("preload","auto")}},playbackRate:function(e){return e>0&&(this.get("HTMLElement")[0].playbackRate=e),this.get("HTMLElement")[0].playbackRate},_createHTMLElement:function(){this.log("_createHTMLElement()",1);if(this.get("start")!=undefined||this.get("stop")!=undefined)this.set("src",this.get("src")+"#t="),this.get("start")!=undefined&&this.set("src",this.get("src")+this.get("start")),this.get("stop")!=undefined&&this.set("src",this.get("src")+this.get("stop"));this.set("HTMLElement",$(document.createElement("video"))),this._applyCallbacks(this.get("HTMLElement"),this._callbacks.HTMLElement);var e=document.createElement("source");$(e).attr("src",this.get("src")),$(e).attr("type",this.get("type")),this.get("HTMLElement").append(e)},_parseDuration:function(){this.log("_parseDuration()",1);var e=this;if(this.get("stop")!=undefined){var t="";t+="Stop: "+this.get("stop")+", ",this.get("start")!=undefined&&this.get("stop")!=undefined?(t+="Start: "+this.get("start"),this.set("duration",this.get("stop")-this.get("start"))):this.get("stop")!=undefined&&(t+="Start: not defined",this.set("duration",this.get("stop"))),this.log("_parseDuration()",2,t),setTimeout(function(){e.trigger("durationknown",e)},50)}else if(this.get("start")!=undefined&&this.get("stop")==undefined){var t="Start: "+this.get("start")+", Stop: undefined, load metadata to get duration";this.log("_parseDuration()",2,t),this.get("HTMLElement").on("loadedmetadata",function(t){e.set("duration",parseFloat(t.target.duration)-e.get("start"));var n="Metadata loaded, duration: "+e.get("duration");e.log("_parseDuration()",2,n),e.set("stop",parseFloat(t.target.duration)),e.trigger("durationknown",e),$(e.get("HTMLElement")).off("loadedmetadata",this)}),this.loadMetaData()}else{var t="Start: undefined, Stop: undefined, load metadata to get duration";this.log("_parseDuration()",2,t),this.get("HTMLElement").on("loadedmetadata",function(t){e.set("duration",parseFloat(t.target.duration));var n="Metadata loaded, duration: "+e.get("duration");e.log("_parseDuration()",2,n),e.set("start",0),e.set("stop",parseFloat(t.target.duration)),e.set("duration",parseFloat(t.target.duration)),e.trigger("durationknown",e),e.get("HTMLElement").off("loadedmetadata",this)}),this.loadMetaData()}},getHTMLElement:function(){return this.get("HTMLElement")},_loadStart:function(e){this.trigger("loadstart",this)},_loadedMetaData:function(e){this.trigger("loadedmetadata",this)},_canPlayThrough:function(e){this.trigger("canplaythrough",this)},_durationChange:function(e){this.trigger("durationchange",this)},_timeUpdate:function(e){this.log("_timeUpdate",1),this.trigger("timeupdate",this)},_ended:function(e){this.trigger("ended",this)},_play:function(e){this.log("_play()",2),this.set("playing",!0),this.trigger("play",this)},_pause:function(e){this.get("stop")>0?this.currentTime()>this.get("stop")?this.trigger("fragmentended",this):(this.set("playing",!1),this.trigger("pause",this)):(this.set("playing",!1),this.trigger("pause",this))},_waiting:function(e){this.log("_waiting()",2)},_buffered:function(e){},_seeking:function(e){this.trigger("seeking",this)},_seeked:function(e){this.trigger("seeked",this)}},{canCreate:function(e){switch(e){case"video/mp4":return Modernizr.video.h264;case"video/webm":return Modernizr.video.webm;case"video/youtube":return!0;case"video/vimeo":return!0}},createVideoElement:function(e){if(!i.canCreate(e.type))throw"VideoElement: Can't create element for source: "+e.src+", of type: "+e.type+", codec not supported by browser.";switch(e.type){case"video/mp4":return new i({src:e.src,type:e.type});case"video/webm":return new i({src:e.src,type:e.type});case"video/youtube":return new YoutubeElement({src:e.src});case"video/vimeo":return new VimeoElement({src:e.src})}}});return i}),define("libs/krusty5-core/videoelement/YoutubeElement",["underscore","backbone","libs/util/EventListener","libs/util/Logger","modernizr"],function(e,t,n,r){var i=t.Model.extend(r).extend(n).extend({logObjectName:"YoutubeElement",defaults:{youtubePlayer:null,HTMLElement:null,duration:0,preloaded:!1,playing:!1,youtubeid:null,timeupdater:null,availableQualities:[],initialPlayoutDone:!1},_callbacks:{},initialize:function(){this.log("initialize()",1),e.bindAll(this),this._createHTMLElement()},play:function(){this.log("play()",1),this.get("youtubePlayer").playVideo()},pause:function(){this.log("pause()",1),this.get("youtubePlayer").pauseVideo()},currentTime:function(e){if(this.get("youtubePlayer"))if(e)this.get("youtubePlayer").seekTo(e,!0);else if(this.get("youtubePlayer").getCurrentTime)return this.get("youtubePlayer").getCurrentTime()},volume:function(e){if(e||e==0)this.get("youtubePlayer").setVolume&&this.get("youtubePlayer").setVolume(e*100);else if(this.get("youtubePlayer").getVolume)return this.get("youtubePlayer").getVolume()/100},playbackRate:function(e){return e=parseFloat(e),this.get("youtubePlayer").setPlaybackRate(e),this.get("youtubePlayer").getPlaybackRate()},loadMetaData:function(){},preload:function(){},_createHTMLElement:function(){function t(){e.set("youtubePlayer",new YT.Player(e.get("HTMLElement").attr("id"),{videoId:e.get("youtubeid"),playerVars:{controls:"0"},events:{onReady:function(){e._initialPlayout()}}}))}var e=this;this.set("HTMLElement",$(document.createElement("div"))),this.get("HTMLElement").attr("id","youtube-player-"+this.get("youtubeid")),$("#youtube-container").append(this.get("HTMLElement")),t(),this.set("HTMLElement",$("iframe#youtube-player-"+this.get("youtubeid")))},_parseDuration:function(){var e=this;this.get("youtubePlayer").getDuration&&this.get("youtubePlayer").getDuration()>0&&(e.set("duration",this.get("youtubePlayer").getDuration()),e.trigger("durationknown",e)),this.get("duration")==0&&(youtubeFeedCallback=function(t){e.set("duration",t.data.duration),e.trigger("durationknown",e)},$.ajax({url:"http://gdata.youtube.com/feeds/api/videos/"+this.get("youtubeid")+"?v=2&alt=jsonc&callback=youtubeFeedCallback"}))},_initialPlayout:function(){var e=this,t=function(t){switch(e.get("youtubePlayer").getPlayerState()){case YT.PlayerState.PLAYING:e.get("initialPlayoutDone")||(e.set("initialPlayoutDone",!0),e.pause(),e._parseDuration(),e._canPlayThrough(),e._applyCallbacks(),e.currentTime(0))}};e.get("youtubePlayer").addEventListener("onStateChange",t),e.play()},_applyCallbacks:function(){var e=this;e.get("youtubePlayer").addEventListener("onStateChange",function(t){switch(e.get("youtubePlayer").getPlayerState()){case YT.PlayerState.PLAYING:e._play();break;case YT.PlayerState.PAUSED:e._pause()}})},quality:function(e){var t=this;if(e){var n="";switch(e){case"180p":n="small";break;case"360p":n="medium";break;case"480p":n="large";break;case"720p":n="hd720";break;case"1080p":n="hd1080"}if(!this.get("youtubePlayer").setPlaybackQuality){this.set("wantedQuality",e);var r=function(){t.get("wantedQuality")&&(t.quality(t.get("wantedQuality")),t.set("wantedQuality",null)),r=null};this.get("youtubePlayer").addEventListener("onReady",r),this.get("youtubePlayer").addEventListener("onPlaybackQualityChange",this._onQualityChanged)}else this.get("youtubePlayer").getPlayerState()==YT.PlayerState.PLAYING&&this.pause(),this.get("youtubePlayer").setPlaybackQuality(n)}},getHTMLElement:function(){return this.get("HTMLElement")},_loadStart:function(e){this.trigger("loadstart",this)},_loadedMetaData:function(e){this.trigger("loadedmetadata",this)},_canPlayThrough:function(e){this.trigger("canplaythrough",this)},_onQualityChanged:function(){this.get("timeBeforeQualityChanged")>0&&(this.currentTime(this.get("timeBeforeQualityChanged")),this.set("timeBeforeQualityChange",0)),this.trigger("donechangingquality",this)},_timeUpdate:function(e){this.log("_timeUpdate",1),this.trigger("timeupdate",this)},_ended:function(e){this.trigger("ended",this)},_play:function(e){this.log("_play()",2),this.set("playing",!0),this.get("timeupdater")||this.set("timeupdater",setInterval(this._timeUpdate,250)),this.trigger("play",this)},_pause:function(e){this.get("stop")>0?this.currentTime()>this.get("stop")?this.trigger("fragmentended",this):(this.set("playing",!1),this.trigger("pause",this)):(this.set("playing",!1),this.trigger("pause",this)),clearInterval(this.get("timeupdater")),this.set("timeupdater",null)},_waiting:function(e){this.log("_waiting()",2)},_seeking:function(e){this.trigger("seeking",this)},_seeked:function(e){this.trigger("seeked",this)}});return i}),define("libs/krusty5-core/playlist/PlaylistItem",["underscore","backbone","libs/util/EventListener","libs/util/Logger","libs/krusty5-core/videoelement/VideoElement","libs/krusty5-core/videoelement/YoutubeElement"],function(e,t,n,r,i,s){var o=t.Model.extend(r).extend(n).extend({self:this,logObjectName:"PlaylistItem",justSwitchedQuality:!1,changeTimeToWhenPlaying:0,defaults:{title:null,active:!1,start:undefined,stop:undefined,_currentTime:null,currentAbsoluteTime:null,sources:null,currentSource:null,duration:0,playlistStart:0,playlistStop:0,screenshots:null,aspectRatio:null,anamorphic:!1,scrubbing:!1},_callbacks:{"this":{"change:active":["_activeChanged"]},element:{active:{play:["_play"],pause:["_pause"],loadedmetadata:["_loadedMetaData"],canplaythrough:["_canPlayThrough"],timeupdate:["_timeUpdate"],seeked:["_seeked"],ended:["_ended"]},always:{durationknown:["_durationKnown"],loadstart:["_loadStart"],canplaythrough:["_canPlayThrough"]}}},initialize:function(){this.log("initialize()",1),e.bindAll(this),this.get("start")!=undefined&&this.get("stop")!=undefined?this.set("duration",parseFloat(this.get("stop")-this.get("start"))):this.get("stop")!=undefined&&this.set("duration",this.get("stop"));var t=this;this.get("duration")!=0&&setTimeout(function(){t.trigger("itemdurationknown",t)},10),this._applyCallbacks(this,this._callbacks["this"])},play:function(){this.log("play()",1),this.get("currentSource").get("element").play()},getAvailableQualities:function(){return this.get("currentSource").get("element")instanceof s?this.get("currentSource").get("element").get("availableQualities"):e.map(this.get("sources"),function(e){return e.get("quality")})},pause:function(){this.log("pause()",1),this.get("currentSource").get("element").pause()},volume:function(e){return this.log("volume( "+e+" )",1),e!=undefined&&this.get("currentSource").get("element").volume(e),this.get("currentSource").get("element").volume()},duration:function(){this.log("duration()",1),this.get("currentSource").get("element").duration()},currentTime:function(e){this.log("currentTime( "+e+")",1);if(e==null)return this.get("currentTime");this.get("start")!=undefined&&(e+=this.get("start"));if(this.get("currentSource")==null)throw"PlaylistItem: No current source set yet.";this.get("currentSource").get("element").logObjectName!="YoutubeElement"?this.get("currentSource").get("element").currentTime(e):this.get("scrubbing")?(this.set("currentTime",e),this.trigger("timeupdate",this)):this.get("currentSource").get("element").currentTime(e)},selectSourceByQuality:function(e){this.log("selectSourceByQuality( "+e+" )",1),this.trigger("changingquality",this),this.get("sources")[0].get("element")instanceof i?this._selectInternalSourceByQuality(e):this.get("sources")[0].get("element")instanceof s&&this._selectYoutubeSourceQuality(e)},playbackRate:function(e){return this.get("currentSource").get("element").playbackRate(e)},_selectInternalSourceByQuality:function(t){var n=this,r=!1;this.get("currentSource")!=null&&(this._removeCallbacks(this.get("currentSource"),this._callbacks.element.always),this.get("currentSource").get("element").get("playing")&&(r=!0,this.get("currentSource").get("element").pause()));var i=this.get("currentSource"),s=e.find(this.get("sources"),function(e){return parseInt(e.get("quality"))==parseInt(t)});s==null&&(s=e.first(this.get("sources"))),this.set("currentSource",s),this.get("currentSource").get("element").preload(),this._applyCallbacks(this.get("currentSource"),this._callbacks.element.always),this.get("active")&&this._applyCallbacks(this.get("currentSource"),this._callbacks.element.active),i!=null&&setTimeout(function(){n.get("currentSource").get("element").currentTime(i.get("element").currentTime()),n.trigger("donechangingquality",this),r&&n.get("currentSource").get("element").play()},1e3)},_selectYoutubeSourceQuality:function(e){var t=this,n=!1,r=0;this.get("currentSource")==null&&(this.set("currentSource",this.get("sources")[0]),this._applyCallbacks(this.get("currentSource"),this._callbacks.element.always),this._applyCallbacks(this.get("currentSource"),this._callbacks.element.active)),this.get("currentSource").get("element").get("playing")&&(n=!0),r=this.get("currentSource").get("element").currentTime();var i=function(){t.get("currentSource").off("donechangingquality",i),t.trigger("donechangingquality",t),n&&setTimeout(function(){t.get("currentSource").get("element").currentTime(r),n&&t.get("currentSource").get("element").play()},1e3)};this.get("currentSource").on("donechangingquality",i),this.get("currentSource").get("element").quality(e)},getVideoElement:function(){return this.log("getVideoElement()",1),this.get("currentSource").get("element").get("HTMLElement")},getScreenshotURI:function(e){if(this.get("screenshots")){this.get("start")!=undefined&&(e+=this.get("start"));var t=Math.floor(e/3600),n=Math.floor((e-t*3600)/60),r=Math.floor(e-t*3600-n*60);return this.get("screenshots")+"/h/"+t+"/m/"+n+"/sec"+r+".jpg"}},preload:function(){this.log("preload()",1),this.get("currentSource").get("element").preload()},_activeChanged:function(e,t,n){this.get("active")?this._applyCallbacks(this.get("currentSource").get("element"),this._callbacks.element.active):this._removeCallbacks(this.get("currentSource").get("element"),this._callbacks.element.active)},_loadStart:function(e){this.log("_loadStart, EVENT",2),this.trigger("loadstart",this)},_loadedMetaData:function(e){this.log("_loadedMetaData, EVENT",2),this.trigger("loadedmetadata",this)},_canPlayThrough:function(e){this.log("_canPlayThrough, EVENT",2),this.trigger("canplaythrough",this)},_play:function(e){this.log("_play, EVENT",2),this.changeTimeToWhenPlaying>0&&(this.get("currentSource").get("element").currentTime(this.changeTimeToWhenPlaying),this.changeTimeToWhenPlaying=0),this.trigger("play",this)},_pause:function(e){this.log("_pause, EVENT",2),this.trigger("pause",this)},_durationKnown:function(e){this.get("duration")!=e.get("duration")&&(this.get("start")!=undefined?this.set("duration",e.get("duration")-this.get("start")):this.set("duration",e.get("duration")),this.trigger("itemdurationknown",this))},_timeUpdate:function(e){this.log("_timeUpdate: "+e.currentTime()+", EVENT",1);var t=e.currentTime();this.set("currentAbsoluteTime",e.currentTime());if(t>this.get("stop")&&this.get("stop")>0&&this.get("active"))this.trigger("ended",this);else{if(this.get("start")!=undefined){if(t<this.get("start")-1&&this.get("active"))return e.currentTime(this.get("start")),!1;t-=this.get("start")}this.set("currentTime",t),this.trigger("timeupdate",this)}},_seeked:function(t){e.isEqual(t,this.get("currentSource").get("element"))&&(this.log("_seeked, EVENT",2),this.trigger("seeked",this))},_ended:function(t){e.isEqual(t,this.get("currentSource").get("element"))&&this.trigger("ended",this)}});return o}),define("libs/krusty5-core/playlist/Playlist",["underscore","backbone","libs/krusty5-core/playlist/PlaylistItem","libs/util/EventListener","libs/util/Logger"],function(e,t,n,r,i){var s=t.Model.extend(i).extend(r).extend({logObjectName:"Playlist",defaults:{items:null,duration:null,quality:null,currentItem:null,currentTime:null,currentPercentage:null,currentVolume:1,scrubbing:!1},_callbacks:{"this":{"change:items":["_itemsChanged"]},playlistItem:{current:{canplaythrough:["_currentItemCanPlayThrough"],loadedmetadata:["_currentItemLoadedMetaData"],timeupdate:["_timeUpdate"],itemalmostdone:["_itemAlmostDone"],ended:["_itemEnded"],play:["_play"],pause:["_pause"],seeked:["_seeked"],changingquality:[],donechangingquality:[]},all:{itemdurationknown:["_durationKnown"]}}},initialize:function(){this.log("initialize()",1),e.bindAll(this),this._applyCallbacks(this,this._callbacks["this"])},play:function(){this.log("play()",1),this.get("currentItem").play()},pause:function(){this.log("pause()",1),this.get("currentItem").pause()},scrubStart:function(){this.log("scrubStart()",1),this.set("scrubbing",!0),this.get("currentItem").set("scrubbing",!0),this.pause()},element:function(){return this.get("currentItem").get("currentSource").get("element")},currentTime:function(t){if(t){var n=this._getItemForPlaylistTime(t);if(!e.isEqual(n,this.get("currentItem"))){var r=this.get("currentItem");this.select(n),r.get("scrubbing")&&(r.set("scrubbing",!1),this.get("currentItem").set("scrubbing",!0))}var i=t-n.get("playlistStart");this.get("currentItem").currentTime(i)}return this.get("currentTime")},scrubTo:function(e){this.log("scrubTo()",1),e<1&&(e=1);var t=parseFloat(this.get("duration")/100*e);this.currentTime(t)},scrubStop:function(e){this.log("scrubStop()",1),this.set("scrubbing",!1),this.get("currentItem").set("scrubbing",!1),e<1&&(e=1);var t=parseFloat(this.get("duration")/100*e);this.currentTime(t),this.play()},volume:function(e){this.log("volume()",1);if(e||e==0)this.set("currentVolume",e),this.get("currentItem").volume(e);return this.get("currentVolume")},chooseQuality:function(t){this.log("chooseQuality()",1),t&&(e.invoke(this.get("items"),"selectSourceByQuality",t),this.set("quality",t))},select:function(t,n){this.log("select( "+t+" )",1);var r=null;this.get("currentItem")!=null&&(this.get("currentItem").set("active",!1),r=this.get("currentItem"),this._removeCallbacks(this.get("currentItem"),this._callbacks.playlistItem.current)),this.set("currentItem",t),this.get("currentItem").set("active",!0),this.get("currentItem").currentTime(0),this.get("currentItem").volume(this.get("currentVolume")),this._applyCallbacks(this.get("currentItem"),this._callbacks.playlistItem.current),r!=null?(e.isEqual(r.get("currentSource").get("element"),this.get("currentItem").get("currentSource").get("element"))||r.get("aspectRatio")!=this.get("currentItem").get("aspectRatio")&&this.trigger("aspectratiochanged",this.get("currentItem").get("aspectRatio")),this.trigger("elementswitched",t)):this.trigger("aspectratiochanged",this.get("currentItem").get("aspectRatio")),n&&this.get("currentItem").play()},selectFirst:function(){this.select(this.get("items")[0])},getScreenshotURI:function(t){var n=e.find(this.get("items"),function(e){return e.get("playlistStart")<t&&e.get("playlistStop")>t||e.get("playlistStart")==t});return n.getScreenshotURI(t-n.get("playlistStart"))},preload:function(){this.log("preload()",1);var t=[];e.each(this.get("items"),function(e){e.preload()},this)},getAvailableQualities:function(){return this.get("currentItem").getAvailableQualities()},playbackRate:function(e){return this.get("currentItem").playbackRate(e)},_getItemForPlaylistTime:function(t){return e.find(this.get("items"),function(e){return e.get("playlistStart")<t&&e.get("playlistStop")>t})},_itemsChanged:function(){e.each(this.get("items"),function(e){this._applyCallbacks(e,this._callbacks.playlistItem.all)},this)},_durationKnown:function(t){this.log("_durationKnown(), EVENT",2);if(this.get("duration")==null){var n=!0,r=0;e.each(this.get("items"),function(e){e.get("duration")==0?n=!1:r+=parseFloat(e.get("duration"))});if(n){this.set("duration",r);var i=0;e.each(this.get("items"),function(e){e.set("playlistStart",i),e.set("playlistStop",parseFloat(e.get("playlistStart")+e.get("duration"))),i+=e.get("duration")}),this.trigger("durationknown",this.get("duration"))}}},_currentItemCanPlayThrough:function(e){this.log("_currentItemCanPlayThrough(), EVENT ",2),e.get("active")&&this.trigger("itemcanplay")},_timeUpdate:function(e){this.log("_currentItemTimeUpdate( "+e+" ), EVENT",3);if(e.get("active")){var t=e.get("currentTime");this.set("currentTime",t+e.get("playlistStart"));if(this.get("duration")!=null){var n=parseFloat((t+e.get("playlistStart"))/this.get("duration"))*100;n==NaN?this.set("currentPercentage",0):this.set("currentPercentage",n)}this.trigger("playlisttimeupdate",this)}},_itemEnded:function(t){if(t.get("active")){this.log("_itemEnded(), EVENT",2);var n=this.get("items")[e.indexOf(this.get("items"),this.get("currentItem"))+1];(n==undefined||!e.isEqual(n.get("currentSource").get("element"),this.get("currentItem").get("currentSource").get("element")))&&this.get("currentItem").pause(),n!=undefined?this.select(n,!0):this.trigger("playlistended")}},_play:function(e){e.get("active")&&(this.log("_play(), EVENT",2),this.trigger("play"))},_pause:function(e){e.get("active")&&(this.log("_pause(), EVENT",2),this.trigger("pause"))}});return s}),define("libs/krusty5-core/playlist/VideoSource",["underscore","backbone","libs/util/EventListener","libs/util/Logger"],function(e,t,n,r){var i=t.Model.extend(r).extend(n).extend({logObjectName:"VideoSource",defaults:{element:null,codecs:[],quality:""},_callbacks:{element:{play:[],pause:[],durationknown:[],loadstart:[],loadedmetadata:[],canplaythrough:["_canPlayThrough"],timeupdate:[],absolutetimeupdate:[],fragmentended:[],fragmentalmostdone:[],seeked:[],ended:[],qualitylevelsknown:[],donechangingquality:[]}},initialize:function(){this.log("initialize()",1),this.get("element")!=null&&this._applyCallbacks(this.get("element"),this._callbacks.element)}});return i}),define("libs/krusty5-core/playlist/VideoSourceCollection",["underscore","backbone","libs/krusty5-core/playlist/VideoSource"],function(e,t,n){var r=t.Collection.extend({lobObjectName:"VideoSourceCollection",model:n});return r}),define("libs/krusty5-core/videoelement/VimeoElement",function(){}),define("libs/krusty5-core/playlist/PlaylistParser",["underscore","backbone","libs/krusty5-core/playlist/Playlist","libs/krusty5-core/playlist/PlaylistItem","libs/krusty5-core/playlist/VideoSource","libs/krusty5-core/playlist/VideoSourceCollection","libs/krusty5-core/videoelement/VideoElement","libs/krusty5-core/videoelement/YoutubeElement","libs/krusty5-core/videoelement/VimeoElement","libs/util/Logger"],function(e,t,n,r,i,s,o,u,a,f){var l=t.Model.extend(f).extend({logObjectName:"PlaylistParser",defaults:{playlist:null,_playlist:null},initialize:function(){this._parse()},_parse:function(){this.log("_parse()",1),this.log("_parse()",2,"Beginning parsing of playlist: "+JSON.stringify(this.get("playlist")));var t=this,r=this.get("playlist").splice(0),i=0;e.each(r,function(e){e.order=i,i++}),this.set("_playlist",new n);var s=this._parseInternalSources(r),o=this._parseExternalSources(r),u=[];e.extend(u,s,o),t.get("_playlist").set("items",u),this.log("_parse()",2,"Parsing of playlist finished.")},_parseInternalSources:function(t){var n=[];e.each(t,function(t){e.each(t.sources,function(r){r.codecs&&e.each(r.codecs,function(e){e.item=t,e.quality=r.quality,t.start!=undefined&&(e.start=t.start),t.stop!=undefined&&(e.stop=t.stop),n.push(e)})})});if(n.length>0){var s=e.groupBy(n,function(e){return e.src});e.each(s,function(t,n){if(t.length==1){var r={src:n,type:t[0].type};t[0].start!=undefined&&(r.start=t[0].start),t[0].stop!=undefined&&(r.stop=t[0].stop);try{var i=o.createVideoElement(r),s=e.find(t[0].item.sources,function(e){return e.quality==t[0].quality});s.element==undefined&&(s.element=i)}catch(u){self.log(u,1)}}else try{var i=o.createVideoElement({src:n,type:t[0].type});e.each(t,function(t){var n=e.find(t.item.sources,function(e){return e.quality==t.quality});n.element==undefined&&(n.element=i)})}catch(u){self.log(u,1)}});var u=[];e.each(t,function(t){var n=0;e.each(t.sources,function(r){r.element==undefined&&t.sources.splice(e.indexOf(t.sources,r)),t.sources[n]=new i(r),n++});if(t.sources.length>0){var s={title:t.title,sources:t.sources,order:t.order};t.start!=undefined&&(s.start=t.start),t.stop!=undefined&&(s.stop=t.stop),t.screenshots!=undefined&&(s.screenshots=t.screenshots),t.aspectRatio!=undefined&&(s.aspectRatio=t.aspectRatio),t.anamorphic!=undefined&&(s.anamorphic=t.aspectRatio),u.push(new r(s))}})}return u},_parseExternalSources:function(t){var n=this,r=[];return e.each(t,function(e){if(e.type)switch(e.type){case"video/youtube":r.push(n._createYoutubeItem(e))}}),r},_createYoutubeItem:function(e){var e=new r({start:e.start,stop:e.stop,screenshots:e.screenshots,sources:[new i({element:new u({youtubeid:e.youtubeid,availableQualities:e.availableQualities})})],order:e.order});return e},getPlaylist:function(){return this.get("_playlist")}});return l}),define("libs/krusty5-core/HTML5Player",["underscore","backbone","libs/krusty5-core/playlist/Playlist","libs/krusty5-core/playlist/PlaylistParser","libs/util/EventListener","libs/util/Logger"],function(e,t,n,r,i,s){var o=t.Model.extend(i).extend(s).extend({logObjectName:"HTML5Player",defaults:{playlistData:null,playlist:null,screenshot:null,componentContext:{},targetElement:null,defaultQuality:"720p",changingQuality:!1,nativeControls:!0,imgLocation:"img/",eventInterval:{timeupdate:250,volumechanged:250},prevVolume:0,ended:!1,playing:!1},_callbacks:{"this":{"change:playlistData":["_parsePlaylist"],"change:nativeControls":["_nativeControlsChanged"]},componentContext:{contextready:["_test"],click:["_componentClicked"],scrub:["scrub"],scrubstart:["scrubStart"],scrubstop:["scrubStop"],volumechange:["_volumeChange"]},playlist:{loadstart:["_loadStart"],durationknown:["_durationKnown"],itemcanplay:["_itemCanPlay"],playlisttimeupdate:["_timeUpdate"],elementswitched:["_elementSwitched"],play:["_play"],pause:["_pause"],"playlist-initialized":["_test"],playlistended:["_playlistEnded"],changingquality:["_changingQuality"],donechangingquality:["_doneChangingQuality"],aspectratiochanged:["_aspectRatioChanged"],qualitylevelsknown:["_qualityLevelsKnown"]}},blockEvent:{timeupdate:!1,volumechanged:!1},initialize:function(){this.log("initialize()",1),console.log("HTML5Player.initialize()!!!!"),e.bindAll(this)},start:function(){var e=this;this.on("externalapisloaded",function(){e.trigger("initialize",e),e.on("readytoplay",function(){$(e.get("targetElement")).trigger("readytoplay")}),e.on("presentationloaded",function(){$(e.get("targetElement")).trigger("presentationloaded")});try{e._applyCallbacks(e,e._callbacks["this"]),e._applyCallbacks(e.get("componentContext"),e._callbacks.componentContext)}catch(t){e.log("initialize()",1,t)}e.get("playlistData")!=null&&e._parsePlaylist(),e.get("nativeControls")||e._nativeControlsChanged(),e.off("externalapisloaded")}),e._loadExternalAPIs()},play:function(){this.log("play()",1);var e=0;this.get("ended")&&(this.get("playlist").selectFirst(),this.set("ended",!1),e=100);var t=this;setTimeout(function(){t.get("playlist").play()},e)},pause:function(){this.log("pause()",1),this.get("playlist").pause()},volume:function(e){if(e!=undefined){this.trigger("volumechanged",e);if(!this.blockEvent.volumechanged||e==0){$(this.get("targetElement")).trigger("volumechanged",e),this.blockEvent.volumechanged=!0;var t=this;setTimeout(function(){t.blockEvent.volumechanged=!1},this.get("eventInterval").volumechanged)}}return this.get("playlist").volume(e)},element:function(){return this.get("playlist").element().getHTMLElement()},mute:function(){this.log("mute()",1),this.set("prevVolume",this.get("playlist").volume()),this.volume(0)},unmute:function(){this.log("unmute()",1),this.volume(this.get("prevVolume"))},error:function(e){this.trigger("error",e)},quality:function(e){return e&&(e!=this.get("playlist").get("quality")&&(this.get("playlist").chooseQuality(e),this._loadElement()),this.set("changingQuality",!0),this.trigger("qualitychanged",e)),this.get("playlist").get("quality")},currentTime:function(e){return this.get("playlist").currentTime(e)},duration:function(){return this.get("playlist").get("duration")},isPlaying:function(){return this.get("playing")},refresh:function(){var e=this;e.get("componentContext").get(".presentation")[0].setDimensions({width:$(window).width(),height:$(window).height()}),e.get("componentContext").resize()},isPlaying:function(){return this.get("playing")},playbackRate:function(e){return this.get("playlist").playbackRate(e)},_parsePlaylist:function(){if(this.get("playlistData")!=null){this.log("_parsePlaylist()",1);var e=new r({playlist:this.get("playlistData")});this.set("playlist",e.getPlaylist());try{this.get("playlist").chooseQuality(this.get("defaultQuality")),this._preloadPlaylist(),this._applyCallbacks(this.get("playlist"),this._callbacks.playlist),this.get("playlist").selectFirst(),this.trigger("volumechanged",this.get("playlist").get("currentVolume")),this._loadElement(),this._updateAvailableQualities()}catch(t){console.log(t),this.log("_parsePlaylist",1,t)}}},_loadExternalAPIs:function(){var e=this;if(!window.YT){var t=document.createElement("script");t.setAttribute("type","text/javascript"),t.setAttribute("src","http://www.youtube.com/iframe_api"),document.getElementsByTagName("head")[0].appendChild(t),window.onYouTubeIframeAPIReady=function(){e.trigger("externalapisloaded")}}else e.trigger("externalapisloaded")},_preloadPlaylist:function(){this.log("preloadPlaylist()",1),this.get("playlist").preload()},_loadScreenshot:function(e){e&&(this.log("loadScreenshot( "+e+" )",1),this.trigger("screenshotchanged",e))},_loadElement:function(){this.log("loadElement()",1),this.trigger("elementchanged")},_durationKnown:function(e){this.log("_durationKnown( "+e+" )",2),this.trigger("durationknown",e),this._loadScreenshot(this.get("playlist").getScreenshotURI(1))},_itemCanPlay:function(){this.log("_itemCanPlay()",2),!this.get("changingQuality")&&!this.get("playlist").get("scrubbing")&&!this.get("ended")&&(this.trigger("presentationloaded"),this.trigger("readytoplay"))},_componentClicked:function(e){this.log("_componentClicked( "+e+" )",1);switch(e.getElement().attr("id")){case"play-button":e.isToggled()?this.pause():this.play();break;case"volume-button":e.isToggled()?this.unmute():this.mute();break;case"dialog":e.getState()=="play"&&this.play();break;case"quality-1080p":this.quality("1080p");break;case"quality-720p":this.quality("720p");break;case"quality-480p":this.quality("480p");break;case"quality-360p":this.quality("360p");break;case"quality-180p":this.quality("180p")}},_volumeChange:function(e){this.log("_volumeChange( "+e+" )",1),this.volume(e.getValue()/100)},_timeUpdate:function(e){this.log("_timeUpdate( "+e+" )",2),this.trigger("timeupdate",e.get("currentTime")),this.get("playlist").get("currentPercentage")>0&&!this.get("playlist").get("scrubbing")&&this.trigger("percentageupdate",this.get("playlist").get("currentPercentage"));if(!this.blockEvent.timeupdate){$(this.get("targetElement")).trigger("timeupdate",e.get("currentTime")),this.blockEvent.timeupdate=!0;var t=this;setTimeout(function(){t.blockEvent.timeupdate=!1},this.get("eventInterval").timeupdate)}},_elementSwitched:function(){this.log("_elementSwitched()",2),this._loadElement(),this._updateAvailableQualities()},_updateAvailableQualities:function(){this.trigger("availablequalitieschanged",this.get("playlist").getAvailableQualities())},scrubStart:function(){this.log("scrubStart()",2);var e=this;this.get("playlist").scrubStart()},scrub:function(e){this.log("scrub()",2),this.get("playlist").scrubTo(e),this._loadScreenshot(this.get("playlist").getScreenshotURI(this.get("playlist").get("currentTime")))},scrubStop:function(e){this.log("scrubStop()",2),this.trigger("timeupdate",this.get("playlist").get("currentTime")),this.get("playlist").scrubStop(e)},_play:function(){this.log("_play()",2),this.trigger("play"),$(this.get("targetElement")).trigger("play"),this.set("playing",!0)},_pause:function(){this.log("_pause()",2),this.get("playlist").get("scrubbing")?this.trigger("seeking"):this.get("changingQuality")?this.trigger("loading","Loading!"):this.get("ended")||this.trigger("readytoplay"),this.trigger("paused"),$(this.get("targetElement")).trigger("pause"),this.set("playing",!1),this.set("playing",!1)},_playlistEnded:function(){this.log("_playlistEnded()",1),this.set("ended",!0),this.trigger("playlistended"),$(this.get("targetElement")).trigger("playlistended")},_changingQuality:function(e){this.trigger("changingquality"),$(this.get("targetElement")).trigger("changingquality")},_doneChangingQuality:function(e){this.set("changingQuality",!1),this.trigger("readytoplay"),$(this.get("targetElement")).trigger("donechangingquality",this.get("playlist").get("quality"))},_aspectRatioChanged:function(e){this.trigger("aspectratiochanged",e),$(this.get("targetElement")).trigger("aspectratiochanged",e)},_nativeControlsChanged:function(){this.trigger("nativecontrolschanged"),$(this.get("targetElement")).trigger("nativecontrolschanged",this.get("nativeControls"))}});return o}),define("krusty5/jquery.krusty5",["underscore","libs/util/Url","libs/springfield/bart/QuickStartConnector","libs/krusty5-core/bart/QSResponseParser","libs/springfield/bart/BartResponseParser","libs/krusty5-gui/GUIController","libs/krusty5-core/HTML5Player"],function(e,t,n,r,i,s,o){(function(t){var i=[];jQuery.fn.krusty5=function(e){if(u[e])return u[e].apply(this,Array.prototype.slice.call(arguments,1));if(typeof e=="object"||!e)return u.init.apply(this,arguments);t.error("Method "+e+" does not exist on jQuery.krusty5")};var u={init:function(i){i==undefined&&(i={}),this.each(function(){var u=this,a={imgLocation:i.imgLocation,eventInterval:i.eventInterval,targetElement:this};e.each(a,function(e,t){e==undefined&&delete a[t]});var f=new s;t(this).data("gui",f);var l=new o(a);t(this).data("player",l),f.setPlayer(l),l.start();if(i.uri)try{var c=n({uri:i.uri,success:function(e){l.set("playlistData",r.parse(e))}})}catch(h){html5player.error(h)}})},nativeControls:function(e){return this.each(function(){t(this).data("player").set("nativeControls",e)}),t(t(this).first()).data("player").get("nativeControls")},duration:function(){return t(t(this).first()).data("player").duration()},isPlaying:function(){return t(t(this).first()).data("player").isPlaying()},dimensions:function(){return t(t(this).first()).data("gui").getDimensions()},play:function(){this.each(function(){t(this).data("player").play()})},pause:function(){this.each(function(){t(this).data("player").pause()})},quality:function(e){this.each(function(){t(this).data("player").quality(e)})},mute:function(){this.each(function(){t(this).data("player").mute()})},unmute:function(){this.each(function(){t(this).data("player").mute()})},volume:function(e){return e<=1&&e>=0&&this.each(function(){t(this).data("player").volume(e)}),t(t(this).first()).data("player").volume()},currentTime:function(e){return this.each(function(){t(this).data("player").currentTime(e)}),t(t(this).first()).data("player").currentTime()},volumeOf:function(){return t(t(this).first()).data("player").volume()},scrubStart:function(){this.each(function(){t(this).data("player").scrubStart()})},scrub:function(e){this.each(function(){t(this).data("player").scrub(e)})},scrubStop:function(e){this.each(function(){t(this).data("player").scrubStop(e)})},error:function(e){return t(t(this).first()).data("player").error(e)},refresh:function(){this.each(function(){t(this).data("player").refresh()})},playbackRate:function(e){return this.each(function(){t(this).data("player").playbackRate(e)}),t(t(this).first()).data("player").playbackRate()}};jQuery.holdReady(!1)})(jQuery)}),require(["krusty5/jquery.krusty5"])